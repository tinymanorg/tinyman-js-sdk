"use strict";var t=require("algosdk"),e=require("base64-js");function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){p(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",i=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function p(t,e,n,a){var s=e&&e.prototype instanceof f?e:f,o=Object.create(s.prototype),i=new E(a||[]);return r(o,"_invoke",{value:y(t,n,i)}),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=p;var d={};function f(){}function m(){}function g(){}var A={};c(A,o,(function(){return this}));var I=Object.getPrototypeOf,x=I&&I(I(D([])));x&&x!==e&&n.call(x,o)&&(A=x);var h=g.prototype=f.prototype=Object.create(A);function v(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function a(r,s,o,i){var u=l(t[r],t,s);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==typeof p&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){a("next",t,o,i)}),(function(t){a("throw",t,o,i)})):e.resolve(p).then((function(t){c.value=t,o(c)}),(function(t){return a("throw",t,o,i)}))}i(u.arg)}var s;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){a(t,n,e,r)}))}return s=s?s.then(r,r):r()}})}function y(t,e,n){var r="suspendedStart";return function(a,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw s;return S()}for(n.method=a,n.arg=s;;){var o=n.delegate;if(o){var i=w(o,n);if(i){if(i===d)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function w(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var a=l(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,d;var s=a.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function D(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return m.prototype=g,r(h,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:m,configurable:!0}),m.displayName=c(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,u,"GeneratorFunction")),t.prototype=Object.create(h),t},t.awrap=function(t){return{__await:t}},v(T.prototype),c(T.prototype,i,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,a,s){void 0===s&&(s=Promise);var o=new T(p(e,n,r,a),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},v(h),c(h,u,"Generator"),c(h,o,(function(){return this})),c(h,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=D,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var i=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(i&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),b(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;b(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:D(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function s(t,e,n,r,a,s,o){try{var i=t[s](o),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,a)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){s(o,r,a,i,u,"next",t)}function u(t){s(o,r,a,i,u,"throw",t)}i(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_(r.key),r)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function p(t,e,n){return(e=_(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,n){return g=m()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&f(a,n.prototype),a},g.apply(null,arguments)}function A(t){var e="function"==typeof Map?new Map:void 0;return A=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return g(t,arguments,d(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,t)},A(t)}function I(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t){var e=m();return function(){var n,r=d(t);if(e){var a=d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return I(t)}(this,n)}}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,s,o,i=[],u=!0,c=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=s.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){c=!0,a=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return i}}(t,e)||T(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||T(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function w(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=T(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){i=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw s}}}}function _(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var b=function(t){return t.SwapRouterStaleDataError="SwapRouterStaleDataError",t.SwapRouterNoRouteError="SwapRouterNoRouteError",t.SwapRouterLowSwapAmountError="SwapRouterLowSwapAmountError",t.SwapRouterInsufficientReservesError="SwapRouterInsufficientReservesError",t.SwapRouterPoolHasNoLiquidityError="SwapRouterPoolHasNoLiquidityError",t.NoAvailablePoolError="NoAvailablePoolError",t.OutputAmountExceedsAvailableLiquidityError="OutputAmountExceedsAvailableLiquidityError",t.UnknownError="UnknownError",t.LowSwapAmountError="LowSwapAmountError",t.AssetDoesNotBelongToPoolError="AssetDoesNotBelongToPoolError",t.InvalidSwapTypeError="InvalidSwapTypeError",t}({}),E=function(t){l(n,A(Error));var e=x(n);function n(t,r){var a;return i(this,n),(a=e.call(this,r)).type=t,a.message=r,Error.captureStackTrace&&Error.captureStackTrace(I(a),n),a}return c(n)}(),D=Uint8Array.from([1]),S=1e5,O=1e5,N=1e5,P=1e5,k=1e5,L=5e4,F=28500,R=1e3,B=1e3,M={mainnet:{base:"https://mainnet.analytics.tinyman.org/api",v1:"https://mainnet.analytics.tinyman.org/api/v1"},testnet:{base:"https://testnet.analytics.tinyman.org/api",v1:"https://testnet.analytics.tinyman.org/api/v1"}},C={V1_1:"v1_1",V2:"v2"},j=0,X={id:"".concat(j),name:"Algorand",unit_name:"ALGO",decimals:6,url:"https://algorand.org",is_liquidity_token:!1,total_amount:"6615503326932151",clawback_address:""},V={V1:"TM1POOL",V1_1:"TMPOOL11",V2:"TMPOOL2"},U="- would result negative",Q="logic eval error:",q="exceeds schema integer count",G=/transaction \w+:/,W=function(t){l(n,A(Error));var e=x(n);function n(t,r){var a;i(this,n);for(var s=arguments.length,o=new Array(s>2?s-2:0),u=2;u<s;u++)o[u-2]=arguments[u];var c=(a=e.call.apply(e,[this].concat(o))).extractMessageFromAlgoSDKError(t);return a.data=t,a.type=a.getErrorType(c),a.setMessage(a.getErrorMessage(c,a.type,r)),a}return c(n,[{key:"setMessage",value:function(t){this.message=t}},{key:"getErrorType",value:function(t){var e="Unknown";return t.includes(U)?e="SlippageTolerance":t.includes(q)?e="ExceedingExcessAmountCount":t.includes(Q)?e="LogicError":t.match(G)&&(e="TransactionError"),e}},{key:"getErrorMessage",value:function(t,e,n){var r;switch(e){case"SlippageTolerance":r="The process failed due to too much slippage in the price. Please adjust the slippage tolerance and try again.";break;case"ExceedingExcessAmountCount":r="The process failed due to the number of excess amounts accumulated for your account in the Tinyman app.";break;case"LogicError":r=t.split(Q)[1];break;case"TransactionError":r=t.split(G)[1];break;case"Unknown":t&&(r=t)}return r||(r=n||"We encountered an unexpected error, try again later."),r.trim()}},{key:"extractMessageFromAlgoSDKError",value:function(t){var e,n,r,a="";return null!=t&&null!==(e=t.response)&&void 0!==e&&null!==(n=e.body)&&void 0!==n&&n.message?a=t.response.body.message:null!=t&&null!==(r=t.response)&&void 0!==r&&r.text?a=t.response.text:"string"==typeof(null==t?void 0:t.message)&&(a=this.isMessageObjectString(null==t?void 0:t.message)?JSON.parse(t.message||"{message: ''}").message:t.message),"string"!=typeof a&&(a=String(a)),a}},{key:"isMessageObjectString",value:function(t){return"string"==typeof t&&t.includes("{message:")}}]),n}();function z(){return(z=o(a().mark((function e(n){var r,s,o,i,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.assetID,o=n.initiatorAddr,e.prev=1,e.next=4,r.getTransactionParams().do();case 4:return i=e.sent,u=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:o,assetIndex:s,amount:0,suggestedParams:i}),e.abrupt("return",[{txn:u,signers:[o]}]);case 9:throw e.prev=9,e.t0=e.catch(1),new W(e.t0,"We encountered something unexpected while opting into this asset. Try again later.");case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function J(t,e){var n=Number(t.id),a=Number(e.id);return n>a?[r(r({},t),{},{id:n}),r(r({},e),{},{id:a})]:[r(r({},e),{},{id:a}),r(r({},t),{},{id:n})]}function Y(t,e){var n=[t,e];return[Math.max.apply(Math,n),Math.min.apply(Math,n)]}function K(t){return Number(t)===j}function H(t){return Number(t.id)}function Z(t){var e,n=t.stateArray,r=void 0===n?[]:n,a=t.shouldDecodeKeys,s=void 0!==a&&a,o={},i=w(r);try{for(i.s();!(e=i.n()).done;){var u=e.value,c=u.key,p=void 0;if(1==u.value.type)p=u.value.bytes;else{if(2!=u.value.type)throw new Error("Unexpected state type: ".concat(u.value.type));p=u.value.uint}o[s?atob(c):c]=p}}catch(t){i.e(t)}finally{i.f()}return o}function $(t){var e,n=t.reduce((function(t,e){return t+e.length}),0),r=new Uint8Array(n),a=0,s=w(t);try{for(s.s();!(e=s.n()).done;){var o=e.value;r.set(o,a),a+=o.length}}catch(t){s.e(t)}finally{s.f()}return r}var tt=100000n,et=100000n,nt=100000n,rt=25000n+25000n,at=25000n+3500n;function st(t){var e=t["apps-total-schema"],n=0n,r=0n;e&&(e["num-byte-slice"]&&(n=e["num-byte-slice"]),e["num-uint"]&&(r=e["num-uint"]));var a=t["apps-local-state"]||[],s=t["created-apps"]||[],o=t.assets||[];return tt+et*BigInt(o.length)+nt*BigInt(s.length+a.length)+at*r+rt*n}function ot(t){return new Promise((function(e){setTimeout((function(){e(null)}),t)}))}function it(t,e){return ut.apply(this,arguments)}function ut(){return(ut=o(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,ot(1e3);case 3:return r=null,t.prev=4,t.next=7,e.pendingTransactionInformation(n).do();case 7:r=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(4);case 12:if(!r){t.next=17;break}if(!r["confirmed-round"]){t.next=15;break}return t.abrupt("return",r);case 15:if(!r["pool-error"]){t.next=17;break}throw new Error("Transaction Rejected: ".concat(r["pool-error"]));case 17:t.next=0;break;case 19:case"end":return t.stop()}}),t,null,[[4,10]])})))).apply(this,arguments)}function ct(t,e,n){if(e>1||e<0)throw new Error("Invalid slippage value. Must be between 0 and 1, got ".concat(e));var r;try{var a="negative"===t?1-e:1+e;r=BigInt(Math.floor(Number(n)*a))}catch(t){throw new Error(t.message)}return r}function pt(t,e){var n=Number(t);return lt({decimalPlaces:n},Math.pow(10,-n)*Number(e))}function lt(t,e){var n=t.decimalPlaces,r=void 0===n?0:n;if(r>0){var a=h(ft(e),2),s=a[0],o=a[1],i=h(ft(Math.round(Number(dt(s,o+r)))),2),u=i[0],c=i[1];return Number(dt(u,c-r))}return Math.round(e)}function dt(t,e){return t+(e<0?"e".concat(e):"e+".concat(e))}function ft(t){if(t.toString().includes("e")){var e=t.toString().split("e");return[parseFloat(e[0]),parseFloat(e[1])]}return[t,0]}function mt(t,e){return gt.apply(this,arguments)}function gt(){return(gt=o(a().mark((function t(e,n){var r,s,o,i,u,c,p,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=[],s=w(n),t.prev=3,s.s();case 5:if((o=s.n()).done){t.next=18;break}return i=o.value,t.next=9,e.sendRawTransaction(i).do();case 9:return u=t.sent,c=u.txId,t.next=13,it(e,c);case 13:p=t.sent,l=p["confirmed-round"],r.push({confirmedRound:l,txnID:c});case 16:t.next=5;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(3),s.e(t.t0);case 23:return t.prev=23,s.f(),t.finish(23);case 26:return t.abrupt("return",r);case 29:throw t.prev=29,t.t1=t.catch(0),new W(t.t1,"We encountered an error while processing this transaction. Try again later.");case 32:case"end":return t.stop()}}),t,null,[[0,29],[3,20,23,26]])})))).apply(this,arguments)}function At(t){return t.reduce((function(t,e){return t+e.txn.fee}),0)}function It(t){return(e=t[0].txn.group)?Buffer.from(e).toString("base64"):"";var e}function xt(t){for(var e=[];;){var n=127&t;if(!(t>>=7)){e.push(n);break}e.push(128|n)}return e}function ht(t){return(new TextEncoder).encode(t)}var vt,Tt=new(function(){function t(){i(this,t),this.clientName="tinyman-js-sdk"}return c(t,[{key:"getClientName",value:function(){return this.clientName}},{key:"setClientName",value:function(t){this.clientName=t}},{key:"getAppCallTxnNoteWithClientName",value:function(t){var e=t===C.V1_1?"v1":t;return ht("tinyman/".concat(e,':j{"origin":"').concat(this.clientName,'"}'))}}]),t}()),yt=(p(vt={},C.V1_1,{testnet:62368684,mainnet:552635992}),p(vt,C.V2,{testnet:148607e3,mainnet:1002541853}),vt);function wt(t,e){var n=yt[e][t];if(!n)throw new Error("No Validator App exists for ".concat(t," network with ").concat(e," contract version"));return n}function _t(){return(_t=o(a().mark((function e(n){var r,s,o,i,u,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.contractVersion,i=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return u=e.sent,c=t.makeApplicationOptInTxnFromObject({from:i,appIndex:wt(s,o),note:Tt.getAppCallTxnNoteWithClientName(o),suggestedParams:u}),e.abrupt("return",[{txn:c,signers:[i]}]);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(){return(bt=o(a().mark((function e(n){var r,s,o,i,u,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.contractVersion,i=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return u=e.sent,c=t.makeApplicationClearStateTxnFromObject({from:i,appIndex:wt(s,o),note:Tt.getAppCallTxnNoteWithClientName(o),suggestedParams:u}),e.abrupt("return",[{txn:c,signers:[i]}]);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Et,Dt,St,Ot=function(t){return t.FixedInput="fixed-input",t.FixedOutput="fixed-output",t}({}),Nt=.003,Pt=function(t){return t[t.INPUT_TXN=0]="INPUT_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN",t}({}),kt=(p(Et={},Ot.FixedInput,1),p(Et,Ot.FixedOutput,2),Et),Lt=2,Ft=ht("swap"),Rt=(p(Dt={},Ot.FixedInput,ht("fixed-input")),p(Dt,Ot.FixedOutput,ht("fixed-output")),Dt),Bt={ASSET_OPT_IN:ht("asset_opt_in")},Mt={testnet:184778019,mainnet:1083651166},Ct=(p(St={},Ot.FixedInput,7),p(St,Ot.FixedOutput,8),St);function jt(t){var e=Qt(t),n=e.assetIn,r=e.assetOut;return pt(r.asset.decimals,Number(r.amount))/pt(n.asset.decimals,Number(n.amount))}function Xt(t){var e=Mt[t];if(!e)throw new Error("Unknown network or network not supported: ".concat(t));return e}function Vt(t){return t[t.length-1].quote.amount_out}function Ut(t){return t[0].quote.amount_in}function Qt(t){return{assetIn:Ut(t),assetOut:Vt(t)}}function qt(t){return Gt.apply(this,arguments)}function Gt(){return(Gt=o(a().mark((function e(n){var r,s,o,i,u,c,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.routerAppID,o=n.assetIDs,i=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return u=e.sent,c=t.makeApplicationNoOpTxnFromObject({from:i,appIndex:s,appArgs:[Bt.ASSET_OPT_IN],foreignAssets:o,suggestedParams:u}),p=o.length,c.fee=t.ALGORAND_MIN_TX_FEE*(p+1),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(t){return zt.apply(this,arguments)}function zt(){return(zt=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,w,_,b,E,D,S,O,N;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.initiatorAddr,s=n.client,o=n.network,i=n.swapType,u=n.route,c=n.slippage,e.next=3,s.getTransactionParams().do();case 3:return p=e.sent,l=[H(u[0].quote.amount_in.asset),H(u[0].quote.amount_out.asset),H(u[1].quote.amount_out.asset)],d=l[0],f=l[1],m=l[2],g=[Number(Ut(u).amount),Number(Vt(u).amount)],A=g[0],I=g[1],x=[u[0].pool.address,u[1].pool.address],h=x[0],v=x[1],T=i===Ot.FixedInput?A:ct("positive",c,A),y=i===Ot.FixedOutput?I:ct("negative",c,I),w=K(d),_=Xt(o),b=w?t.makePaymentTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(_),amount:T,suggestedParams:p}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:r,to:t.getApplicationAddress(_),amount:T,assetIndex:d,suggestedParams:p}),(E=t.makeApplicationNoOpTxnFromObject({from:r,appIndex:_,appArgs:[Ft,Rt[i],t.encodeUint64(y)],foreignApps:[wt(o,C.V2)],foreignAssets:[d,f,m],accounts:[h,v],suggestedParams:p,note:Tt.getAppCallTxnNoteWithClientName(C.V2)})).fee=t.ALGORAND_MIN_TX_FEE*(Ct[i]+1),D=[b,E],e.next=17,Jt({client:s,network:o,assetIDs:[d,f,m]});case 17:if(!((S=e.sent).length>0)){e.next=23;break}return e.next=21,qt({client:s,initiatorAddr:r,assetIDs:S,routerAppID:_});case 21:O=e.sent,D.unshift(O);case 23:return N=t.assignGroupID(D),e.abrupt("return",N.map((function(t){return{txn:t,signers:[r]}})));case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(t){return Yt.apply(this,arguments)}function Yt(){return(Yt=o(a().mark((function e(n){var r,s,o,i,u,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.assetIDs,i=t.getApplicationAddress(Xt(s)),e.next=4,r.accountInformation(i).do();case 4:return u=e.sent,c=u.assets.map((function(t){return t["asset-id"]})),e.abrupt("return",o.filter((function(t){return t!==j&&!c.includes(t)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(t){return Ht.apply(this,arguments)}function Ht(){return(Ht=o(a().mark((function t(e){var n,r,s,o,i,u,c,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetInID,s=e.assetOutID,o=e.swapType,i=e.network,u={asset_in_id:String(r),asset_out_id:String(s),swap_type:o,amount:String(n)},t.next=4,fetch("".concat(M[i].v1,"/swap-router/quotes/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch((function(){throw new Error("Network error")}));case 4:return c=t.sent,t.next=7,c.json();case 7:if(p=t.sent,c.ok){t.next=14;break}if(a=p,!Boolean(a)||void 0===a.fallback_message){t.next=13;break}throw new E(p.type,p.fallback_message);case 13:throw new E(b.UnknownError,"There was an error while getting a quote from Swap Router");case 14:if(!(p.route.length<2)){t.next=16;break}throw new E(b.SwapRouterNoRouteError,"Swap router couldn't find a route for this swap.");case 16:return t.abrupt("return",p);case 17:case"end":return t.stop()}var a}),t)})))).apply(this,arguments)}var Zt=function(t){return t.Direct="direct",t.Router="router",t}({}),$t=4*t.ALGORAND_MIN_TX_FEE;function te(e){return(kt[e]+Lt)*t.ALGORAND_MIN_TX_FEE}function ee(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nt;return Math.ceil(1/t)}function ne(t){return t<ee(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nt)}function re(e){return(kt[e]+1)*t.ALGORAND_MIN_TX_FEE}function ae(t){var e=t.assetIn,n=t.assetOut;return pt(n.decimals,Number(n.amount))/pt(e.decimals,Number(e.amount))}function se(t){var e=t.inputSupply,n=t.outputSupply,r=t.assetIn,a=t.assetOut,s=ae({assetIn:r,assetOut:a}),o=pt(a.decimals,Number(n))/pt(r.decimals,Number(e));return lt({decimalPlaces:5},Math.abs(s/o-1))}function oe(t){if(t.type===Zt.Router){var e=Ut(t.data.route);return{id:H(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetInID,amount:t.data.quote.assetInAmount}}function ie(t){if(t.type===Zt.Router){var e=Vt(t.data.route);return{id:H(e.asset),amount:Number(e.amount)}}return{id:t.data.quote.assetOutID,amount:t.data.quote.assetOutAmount}}function ue(t){return t.type===Zt.Direct?t.data.pool.contractVersion:C.V2}function ce(t){return t.type===Zt.Direct?t.data.quote.rate:jt(t.data.route)}function pe(t){for(var e=t[0],n=ce(e),r=1;r<t.length;r++){var a=t[r],s=ce(a);s>n&&(e=a,n=s)}return e}function le(t){return t instanceof E&&[b.SwapRouterInsufficientReservesError,b.SwapRouterLowSwapAmountError,b.OutputAmountExceedsAvailableLiquidityError,b.LowSwapAmountError].includes(t.type)}var de={type:"logicsig",logic:{bytecode:"BCAIAQCBgICAgICAgPABgICAgICAgIDwAQMEBQYlJA1EMQkyAxJEMRUyAxJEMSAyAxJEMgQiDUQzAQAxABJEMwEQIQcSRDMBGIGCgICAgICAgPABEkQzARkiEjMBGyEEEhA3ARoAgAlib290c3RyYXASEEAAXDMBGSMSRDMBG4ECEjcBGgCABHN3YXASEEACOzMBGyISRDcBGgCABG1pbnQSQAE7NwEaAIAEYnVybhJAAZg3ARoAgAZyZWRlZW0SQAJbNwEaAIAEZmVlcxJAAnkAIQYhBSQjEk0yBBJENwEaARclEjcBGgIXJBIQRDMCADEAEkQzAhAhBBJEMwIhIxJEMwIiIxwSRDMCIyEHEkQzAiQjEkQzAiWACFRNUE9PTDExEkQzAiZRAA+AD1RpbnltYW5Qb29sMS4xIBJEMwIngBNodHRwczovL3RpbnltYW4ub3JnEkQzAikyAxJEMwIqMgMSRDMCKzIDEkQzAiwyAxJEMwMAMQASRDMDECEFEkQzAxElEkQzAxQxABJEMwMSIxJEJCMTQAAQMwEBMwIBCDMDAQg1AUIBsTMEADEAEkQzBBAhBRJEMwQRJBJEMwQUMQASRDMEEiMSRDMBATMCAQgzAwEIMwQBCDUBQgF8MgQhBhJENwEcATEAE0Q3ARwBMwQUEkQzAgAxABNEMwIUMQASRDMDADMCABJEMwIRJRJEMwMUMwMHMwMQIhJNMQASRDMDESMzAxAiEk0kEkQzBAAxABJEMwQUMwIAEkQzAQEzBAEINQFCAREyBCEGEkQ3ARwBMQATRDcBHAEzAhQSRDMDFDMDBzMDECISTTcBHAESRDMCADEAEkQzAhQzBAASRDMCESUSRDMDADEAEkQzAxQzAwczAxAiEk0zBAASRDMDESMzAxAiEk0kEkQzBAAxABNEMwQUMQASRDMBATMCAQgzAwEINQFCAJAyBCEFEkQ3ARwBMQATRDMCADcBHAESRDMCADEAE0QzAwAxABJEMwIUMwIHMwIQIhJNMQASRDMDFDMDBzMDECISTTMCABJEMwEBMwMBCDUBQgA+MgQhBBJENwEcATEAE0QzAhQzAgczAhAiEk03ARwBEkQzAQEzAgEINQFCABIyBCEEEkQzAQEzAgEINQFCAAAzAAAxABNEMwAHMQASRDMACDQBD0M=",address:"ABUKAXTANWR6K6ZYV75DWJEPVWWOU6SFUVRI6QHO44E4SIDLHBTD2CZ64A",size:881,variables:[{name:"TMPL_ASSET_ID_1",type:"int",index:15,length:10},{name:"TMPL_ASSET_ID_2",type:"int",index:5,length:10},{name:"TMPL_VALIDATOR_APP_ID",type:"int",index:74,length:10}],source:"https://github.com/tinymanorg/tinyman-contracts-v1/tree/dc9ab40c58b85c15d58f63a1507e18be76720dbb/contracts/pool_logicsig.teal.tmpl"},name:"pool_logicsig"},fe={type:"app",global_state_schema:{num_uints:0,num_byte_slices:0},local_state_schema:{num_uints:16,num_byte_slices:0},name:"validator_app"},me=c((function t(e){i(this,t),this.schema={numLocalInts:e.local_state_schema.num_uints,numLocalByteSlices:e.local_state_schema.num_byte_slices,numGlobalInts:e.global_state_schema.num_uints,numGlobalByteSlices:e.global_state_schema.num_byte_slices}})),ge=new(function(n){l(a,me);var r=x(a);function a(t,e){var n;return i(this,a),(n=r.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,n.templateVariables=e.logic.variables,n}return c(a,[{key:"generateLogicSigAccountForPool",value:function(n){if(n.asset1ID===n.asset2ID)throw new Error("Assets are the same");var r=wt(n.network,C.V1_1),a=h(Y(n.asset1ID,n.asset2ID),2),s=a[0],o=a[1],i=Array.from(e.toByteArray(this.poolLogicSigContractTemplate)),u={asset_id_1:s,asset_id_2:o,validator_app_id:r},c=0;this.templateVariables.sort((function(t,e){return t.index-e.index}));for(var p=0;p<this.templateVariables.length;p++){var l=this.templateVariables[p],d=u[l.name.split("TMPL_")[1].toLowerCase()],f=l.index-c,m=f+l.length,g=xt(d);c+=l.length-g.length,i=i.slice(0,f).concat(g).concat(i.slice(m))}var A=new Uint8Array(i);return new t.LogicSigAccount(A)}}]),a}())(fe,de),Ae={type:"logicsig",logic:{bytecode:"BoAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgQBbNQA0ADEYEkQxGYEBEkSBAUM="},name:"pool_logicsig"},Ie={type:"app",global_state_schema:{num_uints:0,num_byte_slices:3},local_state_schema:{num_uints:12,num_byte_slices:2},name:"validator_app"},xe=new(function(e){l(r,me);var n=x(r);function r(t,e){var a;return i(this,r),(a=n.call(this,t)).poolLogicSigContractTemplate=e.logic.bytecode,a}return c(r,[{key:"generateLogicSigAccountForPool",value:function(e){if(e.asset1ID===e.asset2ID)throw new Error("Assets are the same");var n=wt(e.network,C.V2),r=h(Y(e.asset1ID,e.asset2ID),2),a=r[0],s=r[1],o={bytes:Array.from(Buffer.from(this.poolLogicSigContractTemplate,"base64")),validatorAppId:Array.from(t.encodeUint64(n)),asset1ID:Array.from(t.encodeUint64(a)),asset2ID:Array.from(t.encodeUint64(s))},i=[].concat(v(o.bytes.slice(0,3)),v(o.validatorAppId.slice(0,8)),v(o.asset1ID.slice(0,8)),v(o.asset2ID.slice(0,8)),v(o.bytes.slice(27)));return new t.LogicSigAccount(new Uint8Array(i))}}]),r}())(Ie,Ae);function he(t){return function(t){return t===C.V2}(t)?xe:ge}function ve(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.IntDecoding.DEFAULT;return new Promise(function(){var t=o(a().mark((function t(o,i){var u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.accountInformation(n).setIntDecoding(s).do();case 3:u=t.sent,o(r(r({},u),{},{minimum_required_balance:ye(u)})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(new Error(t.t0.message||"Failed to fetch account information"));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}())}function Te(t,e){var n=t["apps-local-state"].find((function(t){return t.id===e}));return n?Z({stateArray:n["key-value"],shouldDecodeKeys:!0}):null}function ye(t){var e=t["apps-total-schema"];return S+O*(t.assets||[]).length+P*(t["created-apps"]||[]).length+N*(t["apps-local-state"]||[]).length+L*Number(e&&e["num-byte-slice"]||0)+F*Number(e&&e["num-uint"]||0)+k*(t["apps-total-extra-pages"]||0)}var we=ht("e");function _e(t){return be.apply(this,arguments)}function be(){return(be=o(a().mark((function n(r){var s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,_,b,E;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.client,o=r.pool,i=r.accountAddr,n.next=3,s.accountInformation(i).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:u=n.sent,c=u["apps-local-state"]||[],p=0n,l=0n,d=0n,f=o.account.address(),m=w(c),n.prev=10,m.s();case 12:if((g=m.n()).done){n.next=31;break}if((A=g.value).id==o.validatorAppID){n.next=16;break}return n.abrupt("continue",29);case 16:if(I=A["key-value"]){n.next=19;break}return n.abrupt("break",31);case 19:x=Z({stateArray:I}),h=e.fromByteArray($([t.decodeAddress(f).publicKey,we,t.encodeUint64(o.asset1ID)])),v=e.fromByteArray($([t.decodeAddress(f).publicKey,we,t.encodeUint64(o.asset2ID)])),T=e.fromByteArray($([t.decodeAddress(f).publicKey,we,t.encodeUint64(o.poolTokenID)])),y=x[h],_=x[v],b=x[T],"bigint"==typeof y&&(p=y),"bigint"==typeof _&&(l=_),"bigint"==typeof b&&(d=b);case 29:n.next=12;break;case 31:n.next=36;break;case 33:n.prev=33,n.t0=n.catch(10),m.e(n.t0);case 36:return n.prev=36,m.f(),n.finish(36);case 39:if(!((E={excessAsset1:p,excessAsset2:l,excessPoolTokens:d}).excessAsset1<0n||E.excessAsset2<0n||E.excessPoolTokens<0n)){n.next=42;break}throw new Error("Invalid account excess: ".concat(E));case 42:return n.abrupt("return",E);case 43:case"end":return n.stop()}}),n,null,[[10,33,36,39]])})))).apply(this,arguments)}function Ee(){return(Ee=o(a().mark((function n(r){var s,o,i,u,c,p,l,d,f,m,g,A,I,x,v;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.client,o=r.accountAddr,i=r.validatorAppID,n.next=3,s.accountInformation(o).setIntDecoding(t.IntDecoding.BIGINT).do();case 3:if(u=n.sent,c=u["apps-local-state"]||[],p=c.find((function(t){return t.id==i})),l=[],p&&p["key-value"])for(d=Z({stateArray:p["key-value"]}),f=0,m=Object.entries(d);f<m.length;f++)g=m[f],A=h(g,2),I=A[0],x=A[1],41===(v=e.toByteArray(I)).length&&101===v[32]&&l.push({poolAddress:t.encodeAddress(v.slice(0,32)),assetID:t.decodeUint64(v.slice(33,41),"safe"),amount:parseInt(x)});return n.abrupt("return",l);case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var De,Se=function(t){return t.NOT_CREATED="not created",t.BOOTSTRAP="bootstrap",t.READY="ready",t.ERROR="error",t}({}),Oe=(p(De={},C.V1_1,{asset1:"a1",asset2:"a2"}),p(De,C.V2,{asset1:"asset_1_id",asset2:"asset_2_id",poolTokenID:"pool_token_asset_id",issuedPoolTokens:"issued_pool_tokens",asset1Reserves:"asset_1_reserves",asset2Reserves:"asset_2_reserves",asset1ProtocolFees:"asset_1_protocol_fees",asset2ProtocolFees:"asset_2_protocol_fees",totalFeeShare:"total_fee_share",protocolFeeRatio:"protocol_fee_ratio",cumulativePriceUpdateTimeStamp:"cumulative_price_update_timestamp"}),De),Ne=1e3,Pe=ht("o"),ke=0xffffffffffffffffn;function Le(t){return Fe.apply(this,arguments)}function Fe(){return(Fe=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.client,s=e.network,o=e.asset1ID,i=e.asset2ID,u=he(C.V1_1),c=u.generateLogicSigAccountForPool(e),p=wt(s,C.V1_1),l=c.address(),d=Y(o,i),t.next=8,ve(r,l);case 8:return f=t.sent,m=Te(f,p),g=null===(n=f["created-assets"][0])||void 0===n?void 0:n.index,A={account:c,validatorAppID:p,asset1ID:d[0],asset2ID:d[1],status:m||g?Se.READY:Se.NOT_CREATED,contractVersion:C.V1_1,poolTokenID:g},m&&(A.asset1ID=m[Oe.v1_1.asset1],A.asset2ID=m[Oe.v1_1.asset2]),t.abrupt("return",A);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Re(){return(Re=o(a().mark((function n(r,s){var o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,_,b,E,D,S,O,N,P,k;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,ve(r,s.account.address(),t.IntDecoding.BIGINT);case 2:o=n.sent,i=o["apps-local-state"]||[],u=0n,c=0n,p=0n,l=w(i),n.prev=8,l.s();case 10:if((d=l.n()).done){n.next=29;break}if((f=d.value).id==s.validatorAppID){n.next=14;break}return n.abrupt("continue",27);case 14:if(m=f["key-value"]){n.next=17;break}return n.abrupt("break",29);case 17:g=Z({stateArray:m}),A=e.fromByteArray($([Pe,t.encodeUint64(s.asset1ID)])),I=e.fromByteArray($([Pe,t.encodeUint64(s.asset2ID)])),x=e.fromByteArray($([Pe,t.encodeUint64(s.poolTokenID)])),h=g[A],v=g[I],T=g[x],"bigint"==typeof h&&(u=h),"bigint"==typeof v&&(c=v),"bigint"==typeof T&&(p=T);case 27:n.next=10;break;case 29:n.next=34;break;case 31:n.prev=31,n.t0=n.catch(8),l.e(n.t0);case 34:return n.prev=34,l.f(),n.finish(34);case 37:y=0n,_=0n,b=0n,E=w(o.assets);try{for(E.s();!(D=E.n()).done;)S=D.value,O=S["asset-id"],N=S.amount,O==s.asset1ID?y=BigInt(N):O==s.asset2ID?_=BigInt(N):O==s.poolTokenID&&(b=BigInt(N))}catch(t){E.e(t)}finally{E.f()}if(0===s.asset2ID&&(P=st(o),(_=BigInt(o.amount)-P)<0n&&(_=0n)),!((k={asset1:y-u,asset2:_-c,issuedLiquidity:ke-b+p,round:o.round}).asset1<0n||k.asset2<0n)){n.next=46;break}throw new Error("The pool reserves are below zero. The manager of one of the assets has used clawback to remove assets from this pool. Do not interact with the pool.");case 46:if(!(k.issuedLiquidity<0n||k.issuedLiquidity>ke)){n.next=48;break}throw new Error("Issued liquidity value is out of the expected range ([0n, ".concat(ke,"]): ").concat(k.issuedLiquidity));case 48:return n.abrupt("return",k);case 49:case"end":return n.stop()}}),n,null,[[8,31,34,37]])})))).apply(this,arguments)}function Be(){return Be=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,r=e.address,s=e.network,!(o=d.length>1&&void 0!==d[1]?d[1]:{})[r]){t.next=4;break}return t.abrupt("return",o[r]);case 4:return t.next=6,ve(n,r);case 6:return i=t.sent,u=Te(i,wt(s,C.V1_1)),c=null,u&&(l=i["created-assets"][0],p=l.index,c={asset1ID:u[Oe[C.V1_1].asset1],asset2ID:u[Oe[C.V1_1].asset2],poolTokenID:p},o[r]=c),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)}))),Be.apply(this,arguments)}var Me=Object.freeze({__proto__:null,getPoolAssets:function(t){return Be.apply(this,arguments)},getPoolInfo:Le,getPoolReserves:function(t,e){return Re.apply(this,arguments)}});function Ce(t){return je.apply(this,arguments)}function je(){return(je=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.asset1ID,o=e.asset2ID,i=he(C.V2),u=i.generateLogicSigAccountForPool(e),c=wt(r,C.V2),p=u.address(),l=Y(s,o),t.next=8,ve(n,p);case 8:return d=t.sent,f=Te(d,c),m={account:u,validatorAppID:c,asset1ID:l[0],asset2ID:l[1],status:f?Se.READY:Se.NOT_CREATED,contractVersion:C.V2},f&&(m.asset1ProtocolFees=BigInt(f[Oe.v2.asset1ProtocolFees]),m.asset2ProtocolFees=BigInt(f[Oe.v2.asset2ProtocolFees]),m.asset1Reserves=BigInt(f[Oe.v2.asset1Reserves]),m.asset2Reserves=BigInt(f[Oe.v2.asset2Reserves]),m.issuedPoolTokens=BigInt(f[Oe.v2.issuedPoolTokens]),m.cumulativePriceUpdateTimeStamp=Number(f[Oe.v2.cumulativePriceUpdateTimeStamp]),m.protocolFeeRatio=Number(f[Oe.v2.protocolFeeRatio]),m.totalFeeShare=BigInt(f[Oe.v2.totalFeeShare]),m.poolTokenID=Number(f[Oe.v2.poolTokenID]),m.asset1ID=Number(f[Oe.v2.asset1]),m.asset2ID=Number(f[Oe.v2.asset2])),t.abrupt("return",m);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xe(){return(Xe=o(a().mark((function t(e,n){var r,s,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ve(e,n.account.address());case 2:return r=t.sent,s=Te(r,n.validatorAppID),o={asset1:0n,asset2:0n,issuedLiquidity:0n,round:r.round},s&&(o.asset1=BigInt(s[Oe.v2.asset1Reserves]),o.asset2=BigInt(s[Oe.v2.asset2Reserves]),o.issuedLiquidity=BigInt(s[Oe.v2.issuedPoolTokens])),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ve(){return(Ve=o(a().mark((function t(e){var n,r,s,o,i,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.address,s=e.network,t.next=3,ve(n,r);case 3:return o=t.sent,i=Te(o,wt(s,C.V2)),u=null,i&&(u={asset1ID:i[Oe[C.V2].asset1],asset2ID:i[Oe[C.V2].asset2],poolTokenID:i[Oe[C.V2].poolTokenID]}),t.abrupt("return",u);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ue=Object.freeze({__proto__:null,getPoolAssets:function(t){return Ve.apply(this,arguments)},getPoolInfo:Ce,getPoolReserves:function(t,e){return Xe.apply(this,arguments)}});function Qe(t){return Boolean(t&&!(t.asset1+t.asset2))}var qe,Ge=Object.freeze({__proto__:null,getPoolPairRatio:function(t){var e=Qe(t),n=null;return t&&!e&&t.asset1&&t.asset2&&(n=Number(t.asset1)/Number(t.asset2)),n},getPoolShare:function(t,e){var n=Number(e)/Number(t);return Number.isFinite(n)||(n=0),n},getPoolsForPair:function(t){return Promise.all([Le(t),Ce(t)])},isPoolEmpty:Qe,isPoolNotCreated:function(t){return(null==t?void 0:t.status)===Se.NOT_CREATED},isPoolReady:function(t){return(null==t?void 0:t.status)===Se.READY}}),We=r((p(qe={},C.V1_1,r(r({},Me),Ge)),p(qe,C.V2,r(r({},Ue),Ge)),qe),Ge),ze=function(t){return t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",t[t.POOL_TOKEN_CREATE=2]="POOL_TOKEN_CREATE",t[t.ASSET1_OPT_IN=3]="ASSET1_OPT_IN",t[t.ASSET2_OPT_IN=4]="ASSET2_OPT_IN",t}({}),Je={ASA_ALGO:96e4,ASA_ASA:859e3};function Ye(){return(Ye=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,v,T,y,w,_,b,E,D,S,O;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.asset_1,i=n.asset_2,u=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return c=e.sent,p=J(o,i),l=h(p,2),d=l[0],f=d.id,m=d.unit_name,g=l[1],A=g.id,I=g.unit_name,x=K(A),v=wt(s,C.V1_1),T=ge.generateLogicSigAccountForPool({network:s,asset1ID:f,asset2ID:A}),y=T.address(),w=t.makeApplicationOptInTxnFromObject({from:y,appIndex:v,note:Tt.getAppCallTxnNoteWithClientName(C.V1_1),appArgs:[ht("bootstrap"),t.encodeUint64(f),t.encodeUint64(A)],foreignAssets:x?[f]:[A],suggestedParams:c}),_=t.makeAssetCreateTxnWithSuggestedParamsFromObject({from:y,total:0xffffffffffffffffn,decimals:6,defaultFrozen:!1,unitName:V.V1_1,assetName:"TinymanPool1.1 ".concat(m,"-").concat(I),assetURL:"https://tinyman.org",suggestedParams:c}),b=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:f,amount:0,suggestedParams:c}),E=t.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:y,amount:Ke(x),suggestedParams:c}),(D=[])[ze.FUNDING_TXN]=E,D[ze.VALIDATOR_APP_CALL]=w,D[ze.POOL_TOKEN_CREATE]=_,D[ze.ASSET1_OPT_IN]=b,x||(D[ze.ASSET2_OPT_IN]=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:y,to:y,assetIndex:A,amount:0,suggestedParams:c})),S=t.assignGroupID(D),O=[{txn:S[ze.FUNDING_TXN],signers:[u]},{txn:S[ze.VALIDATOR_APP_CALL],signers:[y]},{txn:S[ze.POOL_TOKEN_CREATE],signers:[y]},{txn:S[ze.ASSET1_OPT_IN],signers:[y]}],S[ze.ASSET2_OPT_IN]&&O.push({txn:S[ze.ASSET2_OPT_IN],signers:[y]}),e.abrupt("return",O);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(t){return t?Je.ASA_ALGO:Je.ASA_ASA}function He(){return(He=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.txGroup,s=n.network,o=n.initiatorSigner,i=n.asset1ID,u=n.asset2ID,e.next=3,o([r]);case 3:return c=e.sent,p=h(c,1),l=p[0],d=Y(i,u),f=h(d,2),m=f[0],g=f[1],A=ge.generateLogicSigAccountForPool({network:s,asset1ID:m,asset2ID:g}),I=[],x=r.map((function(e,n){if(n===ze.FUNDING_TXN)return I.push(e.txn.txID().toString()),l;var r=t.signLogicSigTransactionObject(e.txn,A),a=r.txID,s=r.blob;return I.push(a),s})),e.abrupt("return",{signedTxns:x,txnIDs:I});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(t){return $e.apply(this,arguments)}function $e(){return($e=o(a().mark((function t(e){var n,r,s,o,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.signedTxns,s=e.txnIDs,t.prev=1,t.next=4,n.sendRawTransaction(r).do();case 4:return t.next=6,it(n,s[ze.POOL_TOKEN_CREATE]);case 6:if(o=t.sent,"number"==typeof(i=o["asset-index"])){t.next=10;break}throw new Error("Generated ID is not valid: got ".concat(i));case 10:return t.abrupt("return",{poolTokenID:i});case 13:throw t.prev=13,t.t0=t.catch(1),new W(t.t0,"We encountered something unexpected while bootstraping the pool. Try again later.");case 16:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function tn(){return(tn=o(a().mark((function t(e){var n,r,s,o,i,u,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.pool,o=s.asset1ID,i=s.asset2ID,u=e.signedTxns,c=e.txnIDs,t.next=3,Ze({client:n,signedTxns:u,txnIDs:c});case 3:return t.abrupt("return",We.v1_1.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:i}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var en={generateTxns:function(t){return Ye.apply(this,arguments)},signTxns:function(t){return He.apply(this,arguments)},execute:function(t){return tn.apply(this,arguments)},getBootstrapFundingTxnAmount:Ke};var nn=function(t){return t[t.FUNDING_TXN=0]="FUNDING_TXN",t[t.VALIDATOR_APP_CALL=1]="VALIDATOR_APP_CALL",t}({}),rn={ASA_ALGO:5,ASA_ASA:6};function an(t,e){return sn.apply(this,arguments)}function sn(){return(sn=o(a().mark((function e(n,r){var s,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=null===(s=r.find((function(t){return"appl"===t.txn.type})))||void 0===s?void 0:s.txn.txID())){e.next=7;break}return e.next=4,t.waitForConfirmation(n,o,B);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=void 0;case 8:return i=e.t0,e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(t,e){return un.apply(this,arguments)}function un(){return(un=o(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,an(e,n);case 2:return r=t.sent,t.abrupt("return",null==r?void 0:r["inner-txns"]);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function cn(t,e){return pn.apply(this,arguments)}function pn(){return(pn=o(a().mark((function e(n,r){var s,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on(n,r);case 2:return s=e.sent,a=r[0].txn,o=t.encodeAddress(a.from.publicKey),e.abrupt("return",null==s?void 0:s.reduce((function(e,n){var r=e,a=n.txn.txn;return a.type===t.TransactionType.axfer&&t.encodeAddress(a.arcv)===o?r.push({id:a.xaid,amount:a.aamt}):a.type===t.TransactionType.pay&&t.encodeAddress(a.rcv)===o&&r.push({id:j,amount:a.amt}),r}),[]));case 5:case"end":return e.stop()}var a}),e)})))).apply(this,arguments)}function ln(){return(ln=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,v,T,y,w,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.asset_1,i=n.asset_2,u=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return c=e.sent,p=wt(s,C.V2),l=t.getApplicationAddress(p),d=J(o,i),f=h(d,2),m=f[0].id,g=f[1].id,e.next=9,We.v2.getPoolInfo({client:r,network:s,asset1ID:m,asset2ID:g});case 9:if(e.sent.status!==Se.READY){e.next=12;break}throw new Error("Pool for ".concat(o.unit_name,"-").concat(i.unit_name," already exists"));case 12:return A=xe.generateLogicSigAccountForPool({network:s,asset1ID:m,asset2ID:g}),I=A.address(),x=K(g),(v=t.makeApplicationOptInTxnFromObject({from:I,appIndex:p,appArgs:[ht("bootstrap")],note:Tt.getAppCallTxnNoteWithClientName(C.V2),foreignAssets:[m,g],rekeyTo:l,suggestedParams:c})).fee=fn(x),T=t.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:I,amount:dn(x),suggestedParams:c}),(y=[])[nn.FUNDING_TXN]=T,y[nn.VALIDATOR_APP_CALL]=v,w=t.assignGroupID(y),(_=[])[nn.FUNDING_TXN]={txn:w[nn.FUNDING_TXN],signers:[u]},_[nn.VALIDATOR_APP_CALL]={txn:w[nn.VALIDATOR_APP_CALL],signers:[I]},e.abrupt("return",_);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dn(t){return function(t,e){var n=he(t).schema,r=n.numLocalInts,a=n.numLocalByteSlices,s=S+O+O+N+F*r+L*a;return e||(s+=O),s}(C.V2,t)+fn(t)+O}function fn(e){return((e?rn.ASA_ALGO:rn.ASA_ASA)+1)*t.ALGORAND_MIN_TX_FEE}function mn(){return(mn=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.txGroup,s=n.network,o=n.initiatorSigner,i=n.asset1ID,u=n.asset2ID,e.next=3,o([r]);case 3:return c=e.sent,p=h(c,1),l=p[0],d=Y(i,u),f=h(d,2),m=f[0],g=f[1],A=xe.generateLogicSigAccountForPool({network:s,asset1ID:m,asset2ID:g}),I=[],x=r.map((function(e,n){if(n===nn.FUNDING_TXN)return I.push(e.txn.txID().toString()),l;var r=t.signLogicSigTransactionObject(e.txn,A),a=r.txID,s=r.blob;return I.push(a),s})),e.abrupt("return",{signedTxns:x,txnIDs:I});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gn(){return(gn=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.network,s=e.pool,o=s.asset1ID,i=s.asset2ID,u=e.txGroup,c=e.signedTxns,t.prev=1,t.next=4,n.sendRawTransaction(c).do();case 4:return t.next=6,an(n,u);case 6:if(t.t1=p=t.sent,t.t0=null===t.t1,t.t0){t.next=10;break}t.t0=void 0===p;case 10:if(!t.t0){t.next=14;break}t.t2=void 0,t.next=15;break;case 14:t.t2=null===(l=p["local-state-delta"][0].delta)||void 0===l||null===(d=l.find((function(t){return t.key===btoa(Oe.v2.poolTokenID)})))||void 0===d?void 0:d.value.uint;case 15:if("number"==typeof(f=t.t2)){t.next=18;break}throw new Error("Generated ID is not valid: got ".concat(f));case 18:return t.abrupt("return",We.v2.getPoolInfo({client:n,network:r,asset1ID:o,asset2ID:i}));case 21:throw t.prev=21,t.t3=t.catch(1),new W(t.t3,"We encountered something unexpected while bootstraping the pool. Try again later.");case 24:case"end":return t.stop()}}),t,null,[[1,21]])})))).apply(this,arguments)}var An,In={generateTxns:function(t){return ln.apply(this,arguments)},signTxns:function(t){return mn.apply(this,arguments)},execute:function(t){return gn.apply(this,arguments)},getBootstrapFundingTxnAmount:dn,getTotalCost:function(e){return t.ALGORAND_MIN_TX_FEE+dn(e)}};var xn,hn,vn,Tn,yn=(p(An={},C.V1_1,en),p(An,C.V2,In),p(An,"generateTxns",(function(t){return t.contractVersion===C.V1_1?en.generateTxns(t):In.generateTxns(t)})),p(An,"signTxns",(function(t){return t.contractVersion===C.V1_1?en.signTxns(t):In.signTxns(t)})),p(An,"execute",(function(t){return t.contractVersion===C.V1_1?en.execute(t):In.execute(t)})),p(An,"calculateBootstrapFundingTxnAmount",(function(t){var e=t.contractVersion,n=t.isAlgoPool;return e===C.V1_1?en.getBootstrapFundingTxnAmount(n):In.getBootstrapFundingTxnAmount(n)})),An),wn=function(t){return t[t.FEE_TXN=0]="FEE_TXN",t[t.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",t[t.ASSET1_IN_TXN=2]="ASSET1_IN_TXN",t[t.ASSET2_IN_TXN=3]="ASSET2_IN_TXN",t[t.LIQUDITY_OUT_TXN=4]="LIQUDITY_OUT_TXN",t}({}),_n=5*t.ALGORAND_MIN_TX_FEE,bn=function(t){return t.SINGLE="single",t.FLEXIBLE="flexible",t.INITIAL="initial",t}({}),En=(p(xn={},bn.FLEXIBLE,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),p(xn,bn.SINGLE,{ASSET_IN_TXN:0,VALIDATOR_APP_CALL_TXN:1}),p(xn,bn.INITIAL,{ASSET1_IN_TXN:0,ASSET2_IN_TXN:1,VALIDATOR_APP_CALL_TXN:2}),xn),Dn=(p(hn={},bn.INITIAL,1),p(hn,bn.SINGLE,2),p(hn,bn.FLEXIBLE,2),hn),Sn=(p(vn={},bn.INITIAL,3),p(vn,bn.FLEXIBLE,3),p(vn,bn.SINGLE,2),vn);function On(t){var e,n,r,a=t.reserves,s=t.totalFeeShare,o=t.asset1,i=t.asset2,u=a.asset1*a.asset2,c=a.asset1+BigInt(o.amount),p=a.asset2+BigInt(i.amount),l=c*p,d=BigInt(parseInt(String(Math.sqrt(Number(l*a.issuedLiquidity*a.issuedLiquidity/u))))),f=d-a.issuedLiquidity,m=f*c/d,g=f*p/d,A=BigInt(o.amount)-m,I=BigInt(i.amount)-g;if(A>I){var x=A;r=Pn(x,s),e={id:o.id,amount:x+r,decimals:o.decimals,reserves:a.asset1},n={id:i.id,amount:BigInt(Math.abs(Math.min(Number(I),0))),decimals:i.decimals,reserves:a.asset2},f-=r*d/(c*BigInt(2))}else{var h=I;r=Pn(h,s),e={id:i.id,amount:h+r,decimals:i.decimals,reserves:a.asset2},n={id:o.id,amount:BigInt(Math.abs(Math.min(Number(A),0))),decimals:o.decimals,reserves:a.asset1},f-=r*d/(p*BigInt(2))}return{poolTokenOutAmount:f,internalSwapQuote:{assetIn:e,assetOut:n,swapFees:r,priceImpact:se({inputSupply:e.reserves,outputSupply:n.reserves,assetIn:e,assetOut:n})}}}function Nn(t,e){if(!t.amount||!e.amount)throw new Error("Both assets are required for the initial add liquidity");return BigInt(Math.floor(Math.abs(Math.sqrt(Number(t.amount)*Number(e.amount))-Ne)))}function Pn(t,e){return t*BigInt(e)/(BigInt(1e4)-BigInt(e))}function kn(e){return(Dn[e]+1)*t.ALGORAND_MIN_TX_FEE}var Ln=ht("add_liquidity"),Fn=(p(Tn={},C.V1_1,[ht("mint")]),p(Tn,C.V2,{INITIAL_LIQUIDITY:[ht("add_initial_liquidity")],SINGLE_ASSET_MODE:[Ln,ht("single")],FLEXIBLE_MODE:[Ln,ht("flexible")]}),Tn);function Rn(){return(Rn=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.asset1In,u=n.asset2In,c=n.poolTokenOut,p=n.slippage,l=n.initiatorAddr,d=ct("negative",p,c.amount),e.next=4,r.getTransactionParams().do();case 4:return f=e.sent,m=t.makeApplicationNoOpTxnFromObject({from:o,appIndex:wt(s,C.V1_1),appArgs:Fn.v1_1,accounts:[l],note:Tt.getAppCallTxnNoteWithClientName(C.V1_1),foreignAssets:u.id==j?[i.id,c.id]:[i.id,u.id,c.id],suggestedParams:f}),g=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:f}),A=u.id===j?t.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:u.amount,suggestedParams:f}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:o,assetIndex:u.id,amount:u.amount,suggestedParams:f}),I=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:l,assetIndex:c.id,amount:d,suggestedParams:f}),x=t.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:o,amount:m.fee+I.fee,note:D,suggestedParams:f}),h=t.assignGroupID([x,m,g,A,I]),e.abrupt("return",[{txn:h[0],signers:[l]},{txn:h[1],signers:[o]},{txn:h[2],signers:[l]},{txn:h[3],signers:[l]},{txn:h[4],signers:[o]}]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bn(){return(Bn=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.pool,s=n.txGroup,o=n.initiatorSigner,i=r.account,e.next=4,o([s]);case 4:return u=e.sent,c=h(u,3),p=c[0],l=c[1],d=c[2],f=s.map((function(e,n){return n===wn.FEE_TXN?p:n===wn.ASSET1_IN_TXN?l:n===wn.ASSET2_IN_TXN?d:t.signLogicSigTransactionObject(e.txn,i).blob})),e.abrupt("return",f);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mn(){return(Mn=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,v;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.txGroup,o=e.signedTxns,i=e.initiatorAddr,t.prev=1,u=BigInt(s[wn.LIQUDITY_OUT_TXN].txn.amount),t.next=5,_e({client:n,pool:r,accountAddr:i});case 5:return c=t.sent,t.next=8,mt(n,[o]);case 8:return p=t.sent,l=h(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,g=At(s),A=It(s),t.next=17,_e({client:n,pool:r,accountAddr:i});case 17:return I=t.sent,(x=I.excessPoolTokens-c.excessPoolTokens)<0n&&(x=0n),t.abrupt("return",{round:f,fees:g,poolTokenID:r.poolTokenID,poolTokenOut:u+x,excessAmount:{excessAmountForAddingLiquidity:x,totalExcessAmount:I.excessPoolTokens},txnID:m,groupID:A});case 23:throw t.prev=23,t.t0=t.catch(1),"SlippageTolerance"===(v=new W(t.t0,"We encountered something unexpected while adding liquidity. Try again later.")).type&&v.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),v;case 28:case"end":return t.stop()}}),t,null,[[1,23]])})))).apply(this,arguments)}var Cn=Object.freeze({__proto__:null,execute:function(t){return Mn.apply(this,arguments)},generateTxns:function(t){return Rn.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.reserves,r=t.asset1In,a=t.asset2In;if(0n===n.issuedLiquidity){var s=BigInt(Math.floor(Math.sqrt(Number(r)*Number(a))));if(s<=BigInt(R))throw new Error("Initial liquidity amount is too small. The amount must be greater than ".concat(R,", this quote is for ").concat(s,"."));return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:s-BigInt(R),share:1}}var o=BigInt(r)*n.issuedLiquidity/n.asset1,i=BigInt(a)*n.issuedLiquidity/n.asset2,u=o<i?o:i;return{round:n.round,asset1ID:e.asset1ID,asset1In:BigInt(r),asset2ID:e.asset2ID,asset2In:BigInt(a),poolTokenID:e.poolTokenID,poolTokenOut:u,share:We.getPoolShare(n.issuedLiquidity+u,u)}},signTxns:function(t){return Bn.apply(this,arguments)}});function jn(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])}function Xn(t){return Vn.apply(this,arguments)}function Vn(){return(Vn=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.txGroup,o=e.signedTxns,t.prev=1,t.next=4,mt(n,[o]);case 4:return i=t.sent,u=h(i,1),c=u[0],p=c.confirmedRound,l=c.txnID,t.prev=9,t.next=12,cn(n,s);case 12:if(t.t1=f=t.sent,t.t0=null===t.t1,t.t0){t.next=16;break}t.t0=void 0===f;case 16:if(!t.t0){t.next=20;break}t.t2=void 0,t.next=21;break;case 20:t.t2=f.find((function(t){return t.id===r.poolTokenID}));case 21:d=t.t2,t.next=26;break;case 24:t.prev=24,t.t3=t.catch(9);case 26:return t.abrupt("return",{round:p,assetOut:d,fees:At(s),poolTokenID:r.poolTokenID,txnID:l,groupID:It(s)});case 29:throw t.prev=29,t.t4=t.catch(1),"SlippageTolerance"===(m=new W(t.t4,"We encountered something unexpected while adding liquidity. Try again later.")).type&&m.setMessage("Adding liquidity failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),m;case 34:case"end":return t.stop()}}),t,null,[[1,29],[9,24]])})))).apply(this,arguments)}function Un(){return(Un=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,T,y,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.asset1In,u=n.asset2In,c=n.poolTokenOut,p=n.initiatorAddr,l=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return d=e.sent,f=J(i,u),m=h(f,2),g=m[0],A=m[1],I=K(A.id),x=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:o,assetIndex:g.id,amount:g.amount,suggestedParams:d}),T=I?t.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:o,amount:A.amount,suggestedParams:d}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:o,assetIndex:A.id,amount:A.amount,suggestedParams:d}),(y=t.makeApplicationNoOpTxnFromObject({from:p,appIndex:wt(s,C.V2),note:Tt.getAppCallTxnNoteWithClientName(C.V2),appArgs:[].concat(v(Fn.v2.FLEXIBLE_MODE),[t.encodeUint64(l)]),accounts:[o],foreignAssets:[c.id],suggestedParams:d})).fee=kn(bn.FLEXIBLE),w=t.assignGroupID([x,T,y]),e.abrupt("return",[{txn:w[0],signers:[p]},{txn:w[1],signers:[p]},{txn:w[2],signers:[p]}]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qn=Object.freeze({__proto__:null,execute:Xn,generateTxns:function(t){return Un.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.slippage,r=void 0===n?.05:n,a=t.asset1,s=t.asset2;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity at the moment. To be able to do Flexible Swap, you should first add initial liquidity.");if(e.status!==Se.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var o={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},i=On({reserves:o,totalFeeShare:e.totalFeeShare,asset1:{id:e.asset1ID,amount:a.amount,decimals:a.decimals},asset2:{id:e.asset2ID,amount:s.amount,decimals:s.decimals}}),u=i.poolTokenOutAmount,c=i.internalSwapQuote,p=u-BigInt(Math.ceil(Number(u)*r));return{asset1In:{id:e.asset1ID,amount:BigInt(a.amount)},asset2In:{id:e.asset2ID,amount:BigInt(s.amount)},poolTokenOut:{id:e.poolTokenID,amount:u},share:We.getPoolShare(o.issuedLiquidity+u,u),slippage:r,internalSwapQuote:c,minPoolTokenAssetAmountWithSlippage:p}},signTxns:jn});function qn(){return(qn=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.assetIn,u=n.poolTokenId,c=n.initiatorAddr,p=n.minPoolTokenAssetAmount,e.next=3,r.getTransactionParams().do();case 3:return l=e.sent,d=K(i.id),f=d?t.makePaymentTxnWithSuggestedParamsFromObject({from:c,to:o,amount:i.amount,suggestedParams:l}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:c,to:o,assetIndex:i.id,amount:i.amount,suggestedParams:l}),(m=t.makeApplicationNoOpTxnFromObject({from:c,appIndex:wt(s,C.V2),note:Tt.getAppCallTxnNoteWithClientName(C.V2),appArgs:[].concat(v(Fn.v2.SINGLE_ASSET_MODE),[t.encodeUint64(p)]),accounts:[o],foreignAssets:[u],suggestedParams:l})).fee=kn(bn.SINGLE),g=t.assignGroupID([f,m]),e.abrupt("return",[{txn:g[0],signers:[c]},{txn:g[1],signers:[c]}]);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Gn=Object.freeze({__proto__:null,execute:Xn,generateTxns:function(t){return qn.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.assetIn,r=t.slippage,a=void 0===r?.05:r,s=t.decimals;if(0n===e.issuedPoolTokens)throw new Error("Pool has no liquidity");if(e.status!==Se.READY)throw new Error("Pool is not ready");if(!e.poolTokenID)throw new Error("Pool token ID is not available");var o=n.id===e.asset1ID,i=n.id===e.asset2ID;if(!o&&!i)throw new Error("Provided input asset id didn't match any asset of the pool");var u={id:e.asset1ID,amount:o?n.amount:0,decimals:s.asset1},c={id:e.asset2ID,amount:i?n.amount:0,decimals:s.asset2},p={asset1:e.asset1Reserves||0n,asset2:e.asset2Reserves||0n,issuedLiquidity:e.issuedPoolTokens||0n},l=On({reserves:p,totalFeeShare:e.totalFeeShare||0,asset1:u,asset2:c}),d=l.poolTokenOutAmount,f=l.internalSwapQuote,m=d-BigInt(Math.ceil(Number(d)*a));return{assetIn:{id:o?e.asset1ID:e.asset2ID,amount:BigInt(n.amount)},poolTokenOut:{id:e.poolTokenID,amount:d},share:We.getPoolShare(p.issuedLiquidity+d,d),slippage:a,internalSwapQuote:f,minPoolTokenAssetAmountWithSlippage:m}},signTxns:jn});function Wn(){return(Wn=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.network,i=n.poolAddress,u=n.asset1In,c=n.asset2In,p=n.poolTokenId,l=n.initiatorAddr,d=K(s.asset2ID),e.next=4,r.getTransactionParams().do();case 4:return f=e.sent,m=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:i,assetIndex:s.asset1ID,amount:u.amount,suggestedParams:f}),g=d?t.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:i,amount:c.amount,suggestedParams:f}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:i,assetIndex:s.asset2ID,amount:c.amount,suggestedParams:f}),(A=t.makeApplicationNoOpTxnFromObject({from:l,appIndex:wt(o,C.V2),appArgs:Fn.v2.INITIAL_LIQUIDITY,note:Tt.getAppCallTxnNoteWithClientName(C.V2),accounts:[i],foreignAssets:[p],suggestedParams:f})).fee=kn(bn.INITIAL),e.abrupt("return",t.assignGroupID([m,g,A]).map((function(t){return{txn:t,signers:[l]}})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var zn,Jn=Object.freeze({__proto__:null,execute:Xn,generateTxns:function(t){return Wn.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.asset1,r=t.asset2,a=t.slippage,s=void 0===a?.05:a;if(0n!==e.issuedPoolTokens)throw new Error("Pool already has liquidity");var o=BigInt(Math.floor(Math.sqrt(Number(n.amount)*Number(r.amount))));if(o<=BigInt(Ne))throw new Error("Initial liquidity amount is too small. Liquidity amount must be greater than ".concat(Ne,", this quote is for ").concat(o,"."));return{asset1In:{id:e.asset1ID,amount:BigInt(n.amount)},asset2In:{id:e.asset2ID,amount:BigInt(r.amount)},poolTokenOut:{id:e.poolTokenID,amount:Nn(n,r)},slippage:s}},signTxns:jn}),Yn=Object.freeze({__proto__:null,flexible:Qn,initial:Jn,withSingleAsset:Gn}),Kn=(p(zn={},C.V1_1,Cn),p(zn,C.V2,Yn),zn),Hn=function(t){return t[t.FEE_TXN=0]="FEE_TXN",t[t.VALIDATOR_APP_CALL_TXN=1]="VALIDATOR_APP_CALL_TXN",t[t.ASSET1_OUT_TXN=2]="ASSET1_OUT_TXN",t[t.ASSET2_OUT_TXN=3]="ASSET2_OUT_TXN",t[t.POOL_TOKEN_IN_TXN=4]="POOL_TOKEN_IN_TXN",t}({}),Zn=Object.values(Hn).length,$n=2,tr=ht("remove_liquidity"),er=function(t){return t[t.ASSET_TRANSFER_TXN=0]="ASSET_TRANSFER_TXN",t[t.APP_CALL_TXN=1]="APP_CALL_TXN",t}({});function nr(){return(nr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.poolTokenIn,i=n.asset1Out,u=n.asset2Out,c=n.slippage,p=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return l=e.sent,d=s.account.address(),f=K(s.asset2ID),m=t.makeApplicationNoOpTxnFromObject({from:d,appIndex:s.validatorAppID,appArgs:[ht("burn")],note:Tt.getAppCallTxnNoteWithClientName(C.V1_1),accounts:[p],foreignAssets:f?[s.asset1ID,s.poolTokenID]:[s.asset1ID,s.asset2ID,s.poolTokenID],suggestedParams:l}),g=ct("negative",c,i),A=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:s.asset1ID,amount:g,suggestedParams:l}),I=ct("negative",c,u),x=f?t.makePaymentTxnWithSuggestedParamsFromObject({from:d,to:p,amount:I,suggestedParams:l}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:d,to:p,assetIndex:s.asset2ID,amount:I,suggestedParams:l}),h=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:d,assetIndex:s.poolTokenID,amount:o,suggestedParams:l}),v=m.fee+A.fee+x.fee,T=t.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:d,amount:v,note:D,suggestedParams:l}),(y=[])[Hn.FEE_TXN]=T,y[Hn.VALIDATOR_APP_CALL_TXN]=m,y[Hn.ASSET1_OUT_TXN]=A,y[Hn.ASSET2_OUT_TXN]=x,y[Hn.POOL_TOKEN_IN_TXN]=h,w=t.assignGroupID(y),e.abrupt("return",[{txn:w[Hn.FEE_TXN],signers:[p]},{txn:w[Hn.VALIDATOR_APP_CALL_TXN],signers:[d]},{txn:w[Hn.ASSET1_OUT_TXN],signers:[d]},{txn:w[Hn.ASSET2_OUT_TXN],signers:[d]},{txn:w[Hn.POOL_TOKEN_IN_TXN],signers:[p]}]);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(){return(rr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.pool,s=n.txGroup,o=n.initiatorSigner,e.next=3,o([s]);case 3:return i=e.sent,u=h(i,2),c=u[0],p=u[1],l=r.account,d=s.map((function(e,n){return n===Hn.FEE_TXN?c:n===Hn.POOL_TOKEN_IN_TXN?p:t.signLogicSigTransactionObject(e.txn,l).blob})),e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ar(){return(ar=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,v,T;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.txGroup,o=e.signedTxns,i=e.initiatorAddr,t.prev=1,u=s[Hn.ASSET1_OUT_TXN].txn.amount,c=s[Hn.ASSET2_OUT_TXN].txn.amount,p=s[Hn.POOL_TOKEN_IN_TXN].txn.amount,t.next=7,_e({client:n,pool:r,accountAddr:i});case 7:return l=t.sent,t.next=10,mt(n,[o]);case 10:return d=t.sent,f=h(d,1),m=f[0],g=m.confirmedRound,A=m.txnID,t.next=17,_e({client:n,pool:r,accountAddr:i});case 17:return I=t.sent,(x=I.excessAsset1-l.excessAsset1)<0n&&(x=0n),(v=I.excessAsset2-l.excessAsset2)<0n&&(v=0n),t.abrupt("return",{round:g,fees:At(s),asset1ID:r.asset1ID,asset1Out:BigInt(u)+x,asset2ID:r.asset2ID,asset2Out:BigInt(c)+v,poolTokenID:r.poolTokenID,poolTokenIn:BigInt(p),excessAmounts:[{assetID:r.asset1ID,excessAmountForBurning:x,totalExcessAmount:I.excessAsset1},{assetID:r.asset2ID,excessAmountForBurning:v,totalExcessAmount:I.excessAsset2}],txnID:A,groupID:It(s)});case 25:throw t.prev=25,t.t0=t.catch(1),"SlippageTolerance"===(T=new W(t.t0,"We encountered something unexpected while burning liquidity. Try again later.")).type&&T.setMessage("The burn failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),T;case 30:case"end":return t.stop()}}),t,null,[[1,25]])})))).apply(this,arguments)}var sr={generateTxns:function(t){return nr.apply(this,arguments)},getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),s=n.issuedLiquidity&&a*n.asset1/n.issuedLiquidity,o=n.issuedLiquidity&&a*n.asset2/n.issuedLiquidity;return{round:n.round,poolTokenID:e.poolTokenID,poolTokenIn:a,asset1ID:e.asset1ID,asset1Out:s,asset2ID:e.asset2ID,asset2Out:o}},signTxns:function(t){return rr.apply(this,arguments)},execute:function(t){return ar.apply(this,arguments)}};function or(){return(or=o(a().mark((function e(n){var s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,w,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.quote.type!==Zt.Router){e.next=2;break}return e.abrupt("return",Wt(r(r({},n),{},{route:n.quote.data.route})));case 2:if(s=n.client,o=n.initiatorAddr,i=n.slippage,u=n.swapType,c=n.quote,p=c.data,l=p.pool,d=p.quote,f=d.assetInID,m=d.assetOutID,g=l.account.address(),(A=[l.asset1ID,l.asset2ID]).includes(f)&&A.includes(m)&&f!==m){e.next=9;break}throw new W({pool:l,quote:c},"Input asset (#".concat(f,") and output asset (#").concat(m,") provided to generate transactions do not belong to the pool ").concat(g,"."));case 9:return e.next=11,s.getTransactionParams().do();case 11:return I=e.sent,x=K(f),h=u===Ot.FixedInput?d.assetInAmount:ct("positive",i,d.assetInAmount),v=u===Ot.FixedOutput?d.assetOutAmount:ct("negative",i,d.assetOutAmount),T=x?t.makePaymentTxnWithSuggestedParamsFromObject({from:o,to:g,amount:h,suggestedParams:I}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:g,amount:h,assetIndex:f,suggestedParams:I}),(y=t.makeApplicationNoOpTxnFromObject({from:o,appIndex:l.validatorAppID,appArgs:[Ft,Rt[u],t.encodeUint64(v)],note:Tt.getAppCallTxnNoteWithClientName(C.V2),accounts:[g],foreignAssets:[l.asset1ID,l.asset2ID],suggestedParams:I})).fee=re(u),(w=[])[Pt.INPUT_TXN]=T,w[Pt.APP_CALL_TXN]=y,_=t.assignGroupID(w),e.abrupt("return",[{txn:_[Pt.INPUT_TXN],signers:[o]},{txn:_[Pt.APP_CALL_TXN],signers:[o]}]);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ir(){return(ir=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,v;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.client,i=e.quote,u=e.txGroup,c=e.signedTxns,t.next=3,mt(o,[c]);case 3:return p=t.sent,l=h(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,g=ie(i).id,A=oe(i),t.prev=10,t.next=13,cn(o,u);case 13:I=t.sent,t.next=18;break;case 16:t.prev=16,t.t0=t.catch(10);case 18:return x=null===(n=I)||void 0===n||null===(r=n.find((function(t){return t.id===A.id})))||void 0===r?void 0:r.amount,v=null===(s=I)||void 0===s?void 0:s.find((function(t){return t.id===g})),t.abrupt("return",{round:f,assetIn:{amount:BigInt(A.amount)-BigInt(x||0),id:A.id},assetOut:v,quote:i,txnID:m});case 21:case"end":return t.stop()}}),t,null,[[10,16]])})))).apply(this,arguments)}function ur(){return(ur=o(a().mark((function t(e){var n,r,s,o,i,u,c,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.type,r=e.amount,s=e.assetIn,o=e.assetOut,i=e.network,u=e.isSwapRouterEnabled,c=e.pool,n!==Ot.FixedInput){t.next=7;break}return t.next=4,dr({assetIn:s,assetOut:o,amount:r,isSwapRouterEnabled:u,network:i,pool:c});case 4:p=t.sent,t.next=10;break;case 7:return t.next=9,mr({amount:r,assetIn:s,assetOut:o,isSwapRouterEnabled:u,network:i,pool:c});case 9:p=t.sent;case 10:return t.abrupt("return",p);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function cr(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=t[0].reason;if(2===t.length){var n=t[1].reason;if(le(e)&&!le(n))throw e;throw n}throw e}return t.filter((function(t){return"fulfilled"===t.status&&t.value})).map((function(t){return t.value}))}))}function pr(t){var e=t.amount,n=t.assetIn,r=t.assetOut,a=t.pool;if(!We.isPoolReady(a))throw new E(b.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i=n.id,u=n.decimals,c=r.id,p=r.decimals,l=BigInt(e),d=a.totalFeeShare;if(i===a.asset1ID)s=a.asset1Reserves,o=a.asset2Reserves;else{if(i!==a.asset2ID)throw new E(b.AssetDoesNotBelongToPoolError,"Input asset (#".concat(i,") doesn't belong to the pool ").concat(a.account.address(),"."));s=a.asset2Reserves,o=a.asset1Reserves}var f=Ar({inputSupply:s,outputSupply:o,swapInputAmount:l,totalFeeShare:d,decimals:{assetIn:u,assetOut:p}}),m=f.swapOutputAmount,g=f.totalFeeAmount,A=f.priceImpact;if(m>o)throw new E(b.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(ne(Number(e)))throw new E(b.LowSwapAmountError,"Swap amount is too low.");return{assetInID:i,assetInAmount:l,assetOutID:c,assetOutAmount:m,swapFee:Number(g),rate:pt(p,Number(m))/pt(u,Number(l)),priceImpact:A}}function lr(t){var e=t.amount,n=t.assetIn,r=t.assetOut,a=t.pool;if(!a||!We.isPoolReady(a))throw new E(b.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i=n.id,u=n.decimals,c=r.id,p=r.decimals,l=BigInt(e),d=a.totalFeeShare;if(c===a.asset1ID)s=a.asset2Reserves,o=a.asset1Reserves;else{if(c!==a.asset2ID)throw new E(b.AssetDoesNotBelongToPoolError,"Output asset (#".concat(c,") doesn't belong to the pool ").concat(a.account.address(),"."));s=a.asset1Reserves,o=a.asset2Reserves}var f=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapOutputAmount,a=t.totalFeeShare,s=t.decimals,o=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.outputAmount,a=e*n,s=BigInt(a/(n-r))-e;return s+=BigInt(1),s}({inputSupply:e,outputSupply:n,outputAmount:r}),i=function(t){var e=t.swapAmount,n=t.totalFeeShare,r=Math.floor(Number(e*BigInt(1e4)/(BigInt(1e4)-BigInt(n)))),a=BigInt(r)-e;return a}({swapAmount:o,totalFeeShare:a}),u=o+i,c=se({inputSupply:e,outputSupply:n,assetIn:{amount:u,decimals:s.assetIn},assetOut:{amount:r,decimals:s.assetOut}});return{swapInputAmount:u,totalFeeAmount:i,priceImpact:c}}({inputSupply:s,outputSupply:o,swapOutputAmount:l,totalFeeShare:d,decimals:{assetIn:u,assetOut:p}}),m=f.swapInputAmount,g=f.totalFeeAmount,A=f.priceImpact;if(l>o)throw new E(b.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");if(ne(Number(m)))throw new E(b.LowSwapAmountError,"Swap amount is too low.");return{type:Zt.Direct,data:{pool:a,quote:{assetInID:i,assetInAmount:m,assetOutID:c,assetOutAmount:l,swapFee:Number(g),rate:pt(p,Number(l))/pt(u,Number(m)),priceImpact:A}}}}function dr(t){return fr.apply(this,arguments)}function fr(){return(fr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetIn,s=e.assetOut,o=e.isSwapRouterEnabled,i=e.network,u=e.pool,c=[],u?c.push(new Promise((function(t,e){try{var a=pr({amount:n,assetIn:r,assetOut:s,pool:u});t({type:Zt.Direct,data:{pool:u,quote:a}})}catch(t){e(t)}}))):c.push(Promise.reject(new E(b.NoAvailablePoolError,"There is not an available pool for this asset pair"))),o&&c.push(Kt({amount:n,assetInID:r.id,assetOutID:s.id,swapType:Ot.FixedInput,network:i}).then((function(t){return{type:Zt.Router,data:t}}))),t.next=6,cr(c);case 6:return p=t.sent,t.abrupt("return",pe(p));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mr(t){return gr.apply(this,arguments)}function gr(){return(gr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.amount,r=e.assetIn,s=e.assetOut,o=e.isSwapRouterEnabled,i=e.network,u=e.pool,c=[new Promise((function(t,e){try{t(lr({amount:n,assetIn:r,assetOut:s,pool:u}))}catch(t){e(t)}}))],o&&c.push(Kt({amount:n,assetInID:r.id,assetOutID:s.id,swapType:Ot.FixedOutput,network:i}).then((function(t){return{type:Zt.Router,data:t}}))),t.next=5,cr(c);case 5:return p=t.sent,t.abrupt("return",pe(p));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ar(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapInputAmount,a=t.totalFeeShare,s=t.decimals,o=BigInt(function(t){var e=t.inputAmount,n=t.totalFeeShare;return Math.floor(Number(e*BigInt(n))/1e4)}({inputAmount:r,totalFeeShare:a})),i=function(t){var e=t.inputSupply,n=t.outputSupply,r=t.swapAmount,a=e*n,s=n-BigInt(a/(e+BigInt(r)));return s-=BigInt(1)}({inputSupply:e,outputSupply:n,swapAmount:r-o});return{swapOutputAmount:i,totalFeeAmount:o,priceImpact:se({inputSupply:e,outputSupply:n,assetIn:{amount:r,decimals:s.assetIn},assetOut:{amount:i,decimals:s.assetOut}})}}var Ir={getQuote:function(t){return ur.apply(this,arguments)},getFixedInputSwapQuote:dr,getFixedInputDirectSwapQuote:pr,getFixedOutputDirectSwapQuote:lr,getFixedOutputSwapQuote:mr,generateTxns:function(t){return or.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return ir.apply(this,arguments)},calculateFixedInputSwap:Ar};function xr(t,e){var n,r,a=BigInt(t),s=e.issuedLiquidity;return s>a+BigInt(Ne)?(n=a*e.asset1/s,r=a*e.asset2/s):(n=e.asset1,r=e.asset2),{asset1OutputAmount:n,asset2OutputAmount:r}}function hr(){return(hr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.poolTokenIn,i=n.initiatorAddr,u=n.minAsset1Amount,c=n.minAsset2Amount,p=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(l=e.sent,d=s.account.address(),f=s.poolTokenID){e.next=8;break}throw new Error("Pool token asset ID is missing");case 8:return m=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:d,assetIndex:f,amount:o,suggestedParams:l}),(g=t.makeApplicationNoOpTxnFromObject({from:i,appIndex:s.validatorAppID,note:Tt.getAppCallTxnNoteWithClientName(C.V2),appArgs:[tr,t.encodeUint64(ct("negative",p,u)),t.encodeUint64(ct("negative",p,c))],accounts:[d],foreignAssets:[s.asset1ID,s.asset2ID],suggestedParams:l})).fee=($n+1)*t.ALGORAND_MIN_TX_FEE,(A=[])[er.ASSET_TRANSFER_TXN]=m,A[er.APP_CALL_TXN]=g,I=t.assignGroupID(A),e.abrupt("return",[{txn:I[er.ASSET_TRANSFER_TXN],signers:[i]},{txn:I[er.APP_CALL_TXN],signers:[i]}]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vr(){return(vr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.initiatorAddr,i=n.poolTokenIn,u=n.outputAssetId,c=n.minOutputAssetAmount,p=n.slippage,e.next=3,r.getTransactionParams().do();case 3:if(l=e.sent,d=s.asset1ID,f=s.asset2ID,m=s.account.address(),g=s.poolTokenID){e.next=9;break}throw new Error("Pool token asset ID is missing");case 9:if(A=0,I=0,x=ct("negative",p,c),u!==d){e.next=17;break}A=x,I=0,e.next=23;break;case 17:if(u!==f){e.next=22;break}A=0,I=x,e.next=23;break;case 22:throw new Error("Invalid output asset id. It doesn't match with pool assets");case 23:return h=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:o,to:m,assetIndex:g,amount:i,suggestedParams:l}),(v=t.makeApplicationNoOpTxnFromObject({from:o,appIndex:s.validatorAppID,note:Tt.getAppCallTxnNoteWithClientName(C.V2),appArgs:[tr,t.encodeUint64(A),t.encodeUint64(I)],accounts:[m],foreignAssets:[u],suggestedParams:l})).fee=($n+1)*t.ALGORAND_MIN_TX_FEE,(T=[])[er.ASSET_TRANSFER_TXN]=h,T[er.APP_CALL_TXN]=v,y=t.assignGroupID(T),e.abrupt("return",[{txn:y[er.ASSET_TRANSFER_TXN],signers:[o]},{txn:y[er.APP_CALL_TXN],signers:[o]}]);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tr(){return(Tr=o(a().mark((function t(e){var n,r,s,o,i,u,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.txGroup,s=e.signedTxns,t.next=3,mt(n,[s]);case 3:return o=t.sent,i=h(o,1),u=i[0].txnID,t.prev=6,t.next=9,cn(n,r);case 9:c=t.sent,t.next=14;break;case 12:t.prev=12,t.t0=t.catch(6);case 14:return t.abrupt("return",{outputAssets:c,txnID:u});case 15:case"end":return t.stop()}}),t,null,[[6,12]])})))).apply(this,arguments)}var yr,wr={getQuote:function(t){var e=t.pool,n=t.reserves,r=t.poolTokenIn,a=BigInt(r),s=xr(a,n),o=s.asset1OutputAmount,i=s.asset2OutputAmount;return{round:n.round,asset1Out:{assetId:e.asset1ID,amount:o},asset2Out:{assetId:e.asset2ID,amount:i},poolTokenIn:{assetId:e.poolTokenID,amount:a}}},getSingleAssetRemoveLiquidityQuote:function(t){var e,n=t.pool,r=t.reserves,a=t.poolTokenIn,s=t.assetOutID,o=t.decimals,i=BigInt(a),u=xr(i,r),c=u.asset1OutputAmount,p=u.asset2OutputAmount,l=n.totalFeeShare;if(s===n.asset1ID){var d=Ir.calculateFixedInputSwap({inputSupply:r.asset2-p,outputSupply:r.asset1-c,swapInputAmount:p,totalFeeShare:l,decimals:o}),f=d.swapOutputAmount,m=d.totalFeeAmount,g=d.priceImpact;e={round:r.round,assetOut:{assetId:s,amount:c+f},poolTokenIn:{assetId:n.poolTokenID,amount:i},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:f},swapFees:{assetId:n.asset2ID,amount:m},priceImpact:g}}}else{if(s!==n.asset2ID)throw new Error("assetOutID must be one of the pool assets");var A=Ir.calculateFixedInputSwap({inputSupply:r.asset1-c,outputSupply:r.asset2-p,swapInputAmount:c,totalFeeShare:l,decimals:o}),I=A.swapOutputAmount,x=A.totalFeeAmount,h=A.priceImpact;e={round:r.round,assetOut:{assetId:s,amount:p+I},poolTokenIn:{assetId:n.poolTokenID,amount:i},internalSwapQuote:{amountIn:{assetId:n.asset2ID,amount:p},amountOut:{assetId:n.asset1ID,amount:I},swapFees:{assetId:n.asset2ID,amount:x},priceImpact:h}}}return e},generateTxns:function(t){return hr.apply(this,arguments)},generateSingleAssetOutTxns:function(t){return vr.apply(this,arguments)},signTxns:function(t){var e=t.txGroup;return(0,t.initiatorSigner)([e])},execute:function(t){return Tr.apply(this,arguments)}},_r=(p(yr={},C.V1_1,sr),p(yr,C.V2,wr),yr),br=3n,Er=1000n,Dr=function(t){return t[t.FEE_TXN_INDEX=0]="FEE_TXN_INDEX",t[t.VALIDATOR_APP_CALL_TXN_INDEX=1]="VALIDATOR_APP_CALL_TXN_INDEX",t[t.ASSET_IN_TXN_INDEX=2]="ASSET_IN_TXN_INDEX",t[t.ASSET_OUT_TXN_INDEX=3]="ASSET_OUT_TXN_INDEX",t}(Dr||{});function Sr(){return(Sr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.pool,s=n.txGroup,o=n.initiatorSigner,e.next=3,o([s]);case 3:return i=e.sent,u=h(i,2),c=u[0],p=u[1],l=s.map((function(e,n){return n===Dr.FEE_TXN_INDEX?c:n===Dr.ASSET_IN_TXN_INDEX?p:t.signLogicSigTransactionObject(e.txn,r.account.lsig).blob})),e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Or(){return(Or=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v,T,y,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.client,s=n.quoteAndPool,o=n.swapType,i=n.slippage,u=n.initiatorAddr,c=s.pool,p=s.quote,l=p.assetInID,d=p.assetOutID,f=c.account.address(),(m=[c.asset1ID,c.asset2ID]).includes(l)&&m.includes(d)&&l!==d){e.next=7;break}throw new W({pool:c,quote:p},"Input asset (#".concat(l,") and output asset (#").concat(d,") provided to generate transactions do not belong to the pool ").concat(f,"."));case 7:return e.next=9,r.getTransactionParams().do();case 9:return g=e.sent,A=[ht("swap"),o===Ot.FixedInput?ht("fi"):ht("fo")],I=t.makeApplicationNoOpTxnFromObject({from:f,appIndex:c.validatorAppID,appArgs:A,accounts:[u],note:Tt.getAppCallTxnNoteWithClientName(C.V1_1),foreignAssets:c.asset2ID==j?[c.asset1ID,c.poolTokenID]:[c.asset1ID,c.asset2ID,c.poolTokenID],suggestedParams:g}),x=o===Ot.FixedOutput?ct("positive",i,p.assetInAmount):p.assetInAmount,h=l===j?t.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:f,amount:x,suggestedParams:g}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:u,to:f,assetIndex:l,amount:x,suggestedParams:g}),v=o===Ot.FixedInput?ct("negative",i,p.assetOutAmount):p.assetOutAmount,T=d===j?t.makePaymentTxnWithSuggestedParamsFromObject({from:f,to:u,amount:v,suggestedParams:g}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:f,to:u,assetIndex:d,amount:v,suggestedParams:g}),y=t.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:f,amount:I.fee+T.fee,note:D,suggestedParams:g}),w=t.assignGroupID([y,I,h,T]),e.abrupt("return",[{txn:w[0],signers:[u]},{txn:w[1],signers:[f]},{txn:w[2],signers:[u]},{txn:w[3],signers:[f]}]);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nr(t){var e=t.pool,n=t.reserves,a=t.assetIn,s=t.decimals;if(e.status!==Se.READY)throw new E(b.NoAvailablePoolError,"There is not an available pool for this asset pair");var o,i,u,c=BigInt(a.amount);if(a.id===e.asset1ID)o=e.asset2ID,i=n.asset1,u=n.asset2;else{if(a.id!==e.asset2ID)throw new E(b.AssetDoesNotBelongToPoolError,"Input asset (#".concat(a.id,") doesn't belong to the pool ").concat(e.account.address(),"."));o=e.asset1ID,i=n.asset2,u=n.asset1}var p=c*br/Er,l=u-i*u/(i+(c-p));if(l>u)throw new E(b.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var d={assetIn:{amount:c,decimals:s.assetIn},assetOut:{amount:l,decimals:s.assetOut}},f={round:n.round,assetInID:a.id,assetInAmount:c,assetOutID:o,assetOutAmount:l,swapFee:Number(p),rate:ae(d),priceImpact:se(r({inputSupply:i,outputSupply:u},d))};return{type:Zt.Direct,data:{pool:e,quote:f}}}function Pr(t){return kr.apply(this,arguments)}function kr(){return(kr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A,I,x;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.signedTxns,o=e.assetIn,i=e.assetOut,u=e.initiatorAddr,t.next=3,_e({client:n,pool:r,accountAddr:u});case 3:return c=t.sent,t.next=6,mt(n,[s]);case 6:return p=t.sent,l=h(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,_e({client:n,pool:r,accountAddr:u});case 13:return g=t.sent,i.id===r.asset1ID?(A=c.excessAsset1,I=g.excessAsset1):(A=c.excessAsset2,I=g.excessAsset2),(x=I-A)<0n&&(x=0n),t.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount),assetOutID:i.id,assetOutAmount:BigInt(i.amount)+x,excessAmount:{assetID:i.id,excessAmountForSwap:x,totalExcessAmount:I},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lr(t){var e=t.pool,n=t.reserves,r=t.assetOut,a=t.decimals;if(e.status!==Se.READY)throw new E(b.NoAvailablePoolError,"There is not an available pool for this asset pair");var s,o,i,u=BigInt(r.amount);if(r.id===e.asset1ID)s=e.asset2ID,o=n.asset2,i=n.asset1;else{if(r.id!==e.asset2ID)throw new E(b.AssetDoesNotBelongToPoolError,"Output asset (#".concat(r.id,") doesn't belong to the pool ").concat(e.account.address(),"."));s=e.asset1ID,o=n.asset1,i=n.asset2}if(u>i)throw new E(b.OutputAmountExceedsAvailableLiquidityError,"Output amount exceeds available liquidity.");var c=o*i/(i-u)-o,p=c*Er/(Er-br),l=p-c,d=pt(a.assetOut,Number(u))/pt(a.assetIn,Number(p)),f=pt(a.assetOut,Number(i))/pt(a.assetIn,Number(o)),m=lt({decimalPlaces:5},Math.abs(d/f-1)),g={round:n.round,assetInID:s,assetInAmount:p,assetOutID:r.id,assetOutAmount:u,swapFee:Number(l),rate:d,priceImpact:m};return{type:Zt.Direct,data:{pool:e,quote:g}}}function Fr(t){return Rr.apply(this,arguments)}function Rr(){return(Rr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d,f,m,g,A,I,x;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.signedTxns,o=e.assetIn,i=e.assetOut,u=e.initiatorAddr,t.next=3,_e({client:n,pool:r,accountAddr:u});case 3:return c=t.sent,t.next=6,mt(n,[s]);case 6:return p=t.sent,l=h(p,1),d=l[0],f=d.confirmedRound,m=d.txnID,t.next=13,_e({client:n,pool:r,accountAddr:u});case 13:return g=t.sent,o.id===r.asset1ID?(A=c.excessAsset1,I=g.excessAsset1):(A=c.excessAsset2,I=g.excessAsset2),(x=I-A)<0n&&(x=0n),t.abrupt("return",{round:f,assetInID:o.id,assetInAmount:BigInt(o.amount)-x,assetOutID:i.id,assetOutAmount:BigInt(i.amount),excessAmount:{assetID:o.id,excessAmountForSwap:x,totalExcessAmount:I},txnID:m});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Br(){return(Br=o(a().mark((function t(e){var n,s,o,i,u,c,p,l,d,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.client,s=e.pool,o=e.swapType,i=e.txGroup,u=e.signedTxns,c=e.initiatorAddr,s.status===Se.READY){t.next=3;break}throw new W({pool:s,swapType:o,txGroup:i},"There is not an available pool for this asset pair");case 3:if(t.prev=3,p={id:i[Dr.ASSET_IN_TXN_INDEX].txn.assetIndex||j,amount:i[Dr.ASSET_IN_TXN_INDEX].txn.amount},l={id:i[Dr.ASSET_OUT_TXN_INDEX].txn.assetIndex||j,amount:i[Dr.ASSET_OUT_TXN_INDEX].txn.amount},o!==Ot.FixedInput){t.next=12;break}return t.next=9,Pr({client:n,pool:s,signedTxns:u,assetIn:p,assetOut:l,initiatorAddr:c});case 9:d=t.sent,t.next=15;break;case 12:return t.next=14,Fr({client:n,pool:s,signedTxns:u,assetIn:p,assetOut:l,initiatorAddr:c});case 14:d=t.sent;case 15:return t.abrupt("return",r(r({},d),{},{groupID:It(i),fees:At(i)}));case 18:throw t.prev=18,t.t0=t.catch(3),"SlippageTolerance"===(f=new W(t.t0,"We encountered something unexpected while swapping. Try again later.")).type&&f.setMessage("The swap failed due to too much slippage in the price. Please adjust the slippage tolerance and try again."),f;case 23:case"end":return t.stop()}}),t,null,[[3,18]])})))).apply(this,arguments)}var Mr,Cr={getQuote:function(t,e,n,r,a){return t===Ot.FixedInput?Nr({pool:e,reserves:n,assetIn:r,decimals:a}):Lr({pool:e,reserves:n,assetOut:r,decimals:a})},getFixedInputSwapQuote:Nr,getFixedOutputSwapQuote:Lr,generateTxns:function(t){return Or.apply(this,arguments)},signTxns:function(t){return Sr.apply(this,arguments)},execute:function(t){return Br.apply(this,arguments)},executeFixedOutputSwap:Fr};function jr(t){return Promise.allSettled(t).then((function(t){if(t.every((function(t){return"rejected"===t.status}))){var e=h(t.map((function(t){return t.reason})),2),n=e[0],r=e[1];if(le(n)&&!le(r))throw n;throw r}return t.filter((function(t){return"fulfilled"===t.status&&t.value})).map((function(t){return t.value}))}))}function Xr(){return(Xr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,s=e.assetIn,o=e.assetOut,i=e.isSwapRouterEnabled,u=e.pools,c=[],(p=u.find((function(t){return t.info.contractVersion===C.V1_1})))?c.push(new Promise((function(t,e){try{t(Cr.getFixedInputSwapQuote({pool:p.info,assetIn:{amount:r,id:Number(s.id)},decimals:{assetIn:s.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(t){e(t)}}))):c.push(Promise.reject(new E(b.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=u.find((function(t){return t.info.contractVersion===C.V2})),c.push(Ir.getFixedInputSwapQuote({amount:r,assetIn:{id:H(s),decimals:s.decimals},assetOut:{id:H(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:i,network:e.network})),t.next=8,jr(c);case 8:return d=t.sent,t.abrupt("return",pe(d));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Vr(){return(Vr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.amount,s=e.assetIn,o=e.assetOut,i=e.pools,u=e.isSwapRouterEnabled,c=[],(p=i.find((function(t){return t.info.contractVersion===C.V1_1})))?c.push(new Promise((function(t,e){try{t(Cr.getFixedOutputSwapQuote({pool:p.info,assetOut:{amount:r,id:Number(o.id)},decimals:{assetIn:s.decimals,assetOut:o.decimals},reserves:p.reserves}))}catch(t){e(t)}}))):c.push(Promise.reject(new E(b.NoAvailablePoolError,"Trying to swap from non-existent pool"))),l=i.find((function(t){return t.info.contractVersion===C.V2})),c.push(Ir.getFixedOutputSwapQuote({amount:r,assetIn:{id:H(s),decimals:s.decimals},assetOut:{id:H(o),decimals:o.decimals},pool:null!==(n=null==l?void 0:l.info)&&void 0!==n?n:null,isSwapRouterEnabled:u,network:e.network})),t.next=8,jr(c);case 8:return d=t.sent,t.abrupt("return",pe(d));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ur=(p(Mr={},C.V1_1,Cr),p(Mr,C.V2,Ir),p(Mr,"getQuote",(function(t){var e=t.type;if(e===Ot.FixedInput)return function(t){return Xr.apply(this,arguments)}(t);if(e===Ot.FixedOutput)return function(t){return Vr.apply(this,arguments)}(t);throw new E(b.InvalidSwapTypeError,"Invalid swap type")})),p(Mr,"generateTxns",(function(t){return t.quote.type===Zt.Direct&&ue(t.quote)===C.V1_1?Cr.generateTxns(r(r({},t),{},{quoteAndPool:t.quote.data})):Ir.generateTxns(t)})),p(Mr,"signTxns",(function(t){if(t.quote.type===Zt.Direct&&ue(t.quote)===C.V1_1){var e=t.quote.data.pool;return Cr.signTxns(r(r({},t),{},{pool:e}))}return Ir.signTxns(t)})),p(Mr,"execute",(function(t){return t.contractVersion===C.V1_1?Cr.execute(t):Ir.execute(t)})),Mr);function Qr(){return(Qr=o(a().mark((function t(e){var n,r,s,o,i,u,c,p,l,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.client,r=e.pool,s=e.txGroup,o=e.initiatorSigner,t.prev=1,t.next=4,qr({txGroup:s,pool:r,initiatorSigner:o});case 4:return i=t.sent,t.next=7,mt(n,[i]);case 7:return u=t.sent,c=h(u,1),p=c[0],l=p.txnID,d=p.confirmedRound,t.abrupt("return",{fees:At(s),confirmedRound:d,txnID:l,groupID:It(s)});case 15:throw t.prev=15,t.t0=t.catch(1),new W(t.t0,"We encountered something unexpected while redeeming. Try again later.");case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function qr(t){return Gr.apply(this,arguments)}function Gr(){return(Gr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.txGroup,s=n.pool,o=n.initiatorSigner,e.next=3,o([r]);case 3:return i=e.sent,u=h(i,1),c=u[0],p=s.account.lsig,l=r.map((function(e,n){return 0===n?c:t.signLogicSigTransactionObject(e.txn,p).blob})),e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wr(){return Wr=o(a().mark((function e(n){var r,s,i,u,c,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.data,i=n.initiatorSigner,e.prev=1,u=s.map((function(t){var e=t.txGroup,n=t.pool;return{txns:e,txnFees:At(e),groupID:It(e),lsig:n.account.lsig}})),e.next=5,i(u.map((function(t){return t.txns})));case 5:return c=e.sent,p=Promise.all(u.map((function(e,n){return new Promise(function(){var s=o(a().mark((function s(o,i){var u,p,l,d,f,m;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,u=e.txns.map((function(r,a){return 0===a?c[n]:t.signLogicSigTransactionObject(r.txn,e.lsig).blob})),a.next=4,mt(r,[u]);case 4:p=a.sent,l=h(p,1),d=l[0],f=d.txnID,m=d.confirmedRound,o({fees:e.txnFees,groupID:e.groupID,txnID:f,confirmedRound:m}),a.next=15;break;case 12:a.prev=12,a.t0=a.catch(0),i(a.t0);case 15:case"end":return a.stop()}}),s,null,[[0,12]])})));return function(t,e){return s.apply(this,arguments)}}())}))),e.abrupt("return",p);case 10:throw e.prev=10,e.t0=e.catch(1),new W(e.t0,"We encountered something unexpected while redeeming. Try again later.");case 13:case"end":return e.stop()}}),e,null,[[1,10]])}))),Wr.apply(this,arguments)}function zr(){return(zr=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.assetID,i=n.assetOut,u=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:return c=e.sent,p=s.account.address(),l=t.makeApplicationNoOpTxnFromObject({from:p,appIndex:s.validatorAppID,appArgs:[ht("redeem")],note:Tt.getAppCallTxnNoteWithClientName(s.contractVersion),accounts:[u],foreignAssets:0==s.asset2ID?[s.asset1ID,s.poolTokenID]:[s.asset1ID,s.asset2ID,s.poolTokenID],suggestedParams:c}),d=0===o?t.makePaymentTxnWithSuggestedParamsFromObject({from:p,to:u,amount:BigInt(i),suggestedParams:c}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:p,to:u,assetIndex:o,amount:BigInt(i),suggestedParams:c}),f=t.makePaymentTxnWithSuggestedParamsFromObject({from:u,to:p,amount:l.fee+d.fee,note:D,suggestedParams:c}),m=t.assignGroupID([f,l,d]),e.abrupt("return",[{txn:m[0],signers:[u]},{txn:m[1],signers:[p]},{txn:m[2],signers:[p]}]);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jr(t){var e,n={},r=w(t);try{for(r.s();!(e=r.n()).done;){var a=e.value,s=(new TextDecoder).decode(Buffer.from(a.key,"base64")),o=void 0;o=1===a.value.type?a.value.bytes:a.value.uint,n[s]=o}}catch(t){r.e(t)}finally{r.f()}return n}function Yr(t,e,n){return t*e/n}var Kr=BigInt(31536e3),Hr=BigInt(1e14),Zr=BigInt(1e16),$r={testnet:548587153,mainnet:1385499515},ta=14;function ea(t){return na.apply(this,arguments)}function na(){return(na=o(a().mark((function e(n){var r,s,o,i,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.assetIDs,i=t.getApplicationAddress($r[s]),e.next=4,ve(r,i);case 4:return u=e.sent.assets.map((function(t){return t["asset-id"]})),e.abrupt("return",o.filter((function(t){return t!==j&&!u.includes(t)})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ra(){return(ra=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,T,y,w,_,b,E,D,S;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.network,o=n.poolAddress,i=n.poolTokenId,u=n.lendingManagerId,c=n.asset1In,p=n.asset2In,l=n.initiatorAddr,d=t.getApplicationAddress($r[s]),e.next=4,r.getTransactionParams().do();case 4:return f=e.sent,m=[c,p].sort((function(t,e){return e.fAssetId-t.fAssetId})),g=h(m,2),A=g[0],I=g[1],x=K(I.id),T=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:d,assetIndex:A.id,amount:A.amount,suggestedParams:f}),y=x?t.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:d,amount:I.amount,suggestedParams:f}):t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:l,to:d,assetIndex:I.id,amount:I.amount,suggestedParams:f}),(w=t.makeApplicationNoOpTxnFromObject({from:l,appIndex:$r[s],appArgs:[ht("add_liquidity"),t.decodeAddress(o).publicKey,t.encodeUint64(A.lendingAppId),t.encodeUint64(I.lendingAppId)],foreignAssets:[A.id,I.id,A.fAssetId,I.fAssetId],foreignApps:[A.lendingAppId,I.lendingAppId,u],accounts:[o],suggestedParams:f})).fee=t.ALGORAND_MIN_TX_FEE*(ta+1),_=wt(s,C.V2),b=t.makeApplicationNoOpTxnFromObject({from:l,appIndex:$r[s],appArgs:[ht("noop")],foreignAssets:[i],foreignApps:[_],accounts:[o],suggestedParams:f}),E=[T,y,w,b],e.next=16,ea({client:r,network:s,assetIDs:[A.id,I.id,A.fAssetId,I.fAssetId,i]});case 16:return(D=e.sent).length&&((S=[t.makePaymentTxnWithSuggestedParamsFromObject({from:l,to:d,amount:O*D.length,suggestedParams:f}),t.makeApplicationNoOpTxnFromObject({from:l,appIndex:$r[s],appArgs:[ht("asset_optin")].concat(v(D.map((function(e){return t.encodeUint64(e)})))),foreignAssets:v(D),suggestedParams:f})])[1].fee=(D.length+1)*t.ALGORAND_MIN_TX_FEE,E.unshift.apply(E,S)),e.abrupt("return",t.assignGroupID(E).map((function(t){return{txn:t,signers:[l]}})));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function aa(){return(aa=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m,g,A,I,x,h,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.pool,o=n.poolTokenIn,i=n.initiatorAddr,u=n.asset1Out,c=n.asset2Out,p=n.lendingManagerId,l=n.network,d=t.getApplicationAddress($r[l]),e.next=4,r.getTransactionParams().do();case 4:if(f=e.sent,m=s.account.address(),g=s.poolTokenID){e.next=9;break}throw new Error("Pool token asset ID is missing");case 9:return A=t.makeAssetTransferTxnWithSuggestedParamsFromObject({from:i,to:d,assetIndex:g,amount:o,suggestedParams:f}),(I=t.makeApplicationNoOpTxnFromObject({from:i,appIndex:$r[l],appArgs:[ht("remove_liquidity"),t.decodeAddress(m).publicKey,t.encodeUint64(u.lendingAppId),t.encodeUint64(c.lendingAppId)],accounts:[m],foreignAssets:[u.id,c.id,u.fAssetId,c.fAssetId],foreignApps:[u.lendingAppId,c.lendingAppId,p],suggestedParams:f})).fee=t.ALGORAND_MIN_TX_FEE*(ta+1),x=wt(l,C.V2),h=t.makeApplicationNoOpTxnFromObject({from:i,appIndex:$r[l],appArgs:[ht("noop")],accounts:[m],foreignAssets:[g,u.fAssetId,c.fAssetId],foreignApps:[x],suggestedParams:f}),v=t.assignGroupID([A,I,h]),e.abrupt("return",v.map((function(t){return{txn:t,signers:[i]}})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sa(t,e,n){var r=BigInt(Math.floor((new Date).getTime()/1e3)-function(t){return null!=t?t:Math.floor((new Date).getTime()/1e3)}(n));return Yr(t,Zr+e*r/Kr,Zr)}function oa(){return(oa=o(a().mark((function t(e,n){var r,s,o,i,u,c,p,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getApplicationByID(n).do();case 2:return r=t.sent,s=r.params["global-state"],o=Jr(s),i=Number(Buffer.from(o.pm,"base64").readBigUInt64BE(0)),u=Buffer.from(o.i,"base64"),c=u.readBigUInt64BE(32),p=u.readBigUInt64BE(40),l=Number(u.readBigUInt64BE(48)),t.abrupt("return",{appId:n,managerAppId:i,depositInterestRate:c,depositInterestIndex:p,lastUpdate:l});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ia={AddLiquidity:Object.freeze({__proto__:null,generateTxns:function(t){return ra.apply(this,arguments)},getAddLiquidityTotalFee:function(e){return t.ALGORAND_MIN_TX_FEE*(4+ta)+(e?(e+1)*t.ALGORAND_MIN_TX_FEE+e*O:0)}}),RemoveLiquidity:Object.freeze({__proto__:null,generateTxns:function(t){return aa.apply(this,arguments)},getRemoveLiquidityTotalFee:function(){return t.ALGORAND_MIN_TX_FEE*(3+ta)}}),calculateWithdrawReturn:function(t){var e=t.withdrawAmount,n=sa(t.depositInterestIndex,t.depositInterestRate,t.lastUpdate);return Yr(BigInt(e),n,Hr)},calculateDepositReturn:function(t){var e=t.depositAmount,n=sa(t.depositInterestIndex,t.depositInterestRate,t.lastUpdate);return BigInt(e)*Hr/n},getFolksWrapperAppOptInRequiredAssetIDs:ea};function ua(e){var n=e.suggestedParams,r=e.stakingAppID,a=e.initiatorAddr,s=e.liquidityAssetID,o=e.program,i=e.amount,u=t.encodeUint64(i),c=t.encodeUint64(o.id);return t.makeApplicationNoOpTxnFromObject({appIndex:r,from:a,suggestedParams:n,foreignAssets:[s],accounts:[o.accountAddress],appArgs:[ht("commit"),u],note:$([ht("tinymanStaking/v1:b"),c,t.encodeUint64(s),u])})}function ca(){return(ca=o(a().mark((function e(n){var r,s,o,i,u,c,p,l,d,f,m;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,s=n.stakingAppID,o=n.program,i=n.requiredAssetID,u=n.liquidityAssetID,c=n.amount,p=n.initiatorAddr,e.next=3,r.getTransactionParams().do();case 3:if(l=e.sent,d=ua({suggestedParams:l,stakingAppID:s,program:o,liquidityAssetID:u,initiatorAddr:p,amount:c}),f=[d],"number"!=typeof i){e.next=10;break}return m=t.makeApplicationNoOpTxnFromObject({appIndex:s,from:p,suggestedParams:l,foreignAssets:[i],accounts:[o.accountAddress],appArgs:[ht("log_balance")]}),f=t.assignGroupID([d,m]),e.abrupt("return",[{txn:f[0],signers:[p]},{txn:f[1],signers:[p]}]);case 10:return e.abrupt("return",[{txn:f[0],signers:[p]}]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}exports.ALGO_ASSET=X,exports.ALGO_ASSET_ID=j,exports.ASSET_OPT_IN_PROCESS_TXN_COUNT=1,exports.AddLiquidity=Kn,exports.BASE_MINIMUM_BALANCE=S,exports.Bootstrap=yn,exports.CONTRACT_VERSION=C,exports.LendingPool=ia,exports.MINIMUM_ADD_LIQUIDITY_AMOUNT=R,exports.MINIMUM_BALANCE_REQUIRED_PER_APP=N,exports.MINIMUM_BALANCE_REQUIRED_PER_ASSET=O,exports.MINIMUM_BALANCE_REQUIRED_PER_BYTE_SCHEMA=L,exports.MINIMUM_BALANCE_REQUIRED_PER_INT_SCHEMA_VALUE=F,exports.OPT_IN_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.OPT_OUT_VALIDATOR_APP_PROCESS_TXN_COUNT=1,exports.POOL_TOKEN_UNIT_NAME=V,exports.PoolStatus=Se,exports.REDEEM_PROCESS_TXN_COUNT=3,exports.RemoveLiquidity=_r,exports.Swap=Ur,exports.SwapQuoteError=E,exports.SwapQuoteErrorType=b,exports.SwapQuoteType=Zt,exports.SwapType=Ot,exports.V1_1AddLiquidityTxnIndices=wn,exports.V1_1_ADD_LIQUIDITY_PROCESS_TXN_COUNT=5,exports.V1_1_REMOVE_LIQUIDITY_TXN_COUNT=Zn,exports.V2AddLiquidityTxnIndices=En,exports.V2AddLiquidityType=bn,exports.V2_REMOVE_LIQUIDITY_APP_CALL_INNER_TXN_COUNT=$n,exports.applySlippageToAmount=ct,exports.calculateAccountMinimumRequiredBalance=ye,exports.calculatePriceImpact=se,exports.calculateSwapRate=ae,exports.combineAndRegroupSignerTxns=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var s=n.flat(),o=s.map((function(e){var n=e.txn;return n.group=void 0,t.decodeUnsignedTransaction(t.encodeUnsignedTransaction(n))})),i=t.assignGroupID(o);return s.map((function(t,e){return r(r({},t),{},{txn:i[e]})}))},exports.convertFromBaseUnits=pt,exports.convertToBaseUnits=function(t,e){return lt({decimalPlaces:0},Math.pow(10,Number(t))*Number(e))},exports.fetchFolksLendingPool=function(t,e){return oa.apply(this,arguments)},exports.generateOptIntoAssetTxns=function(t){return z.apply(this,arguments)},exports.generateOptIntoValidatorTxns=function(t){return _t.apply(this,arguments)},exports.generateOptOutOfValidatorTxns=function(t){return bt.apply(this,arguments)},exports.generateRedeemTxns=function(t){return zr.apply(this,arguments)},exports.generateSwapRouterAssetOptInTransaction=qt,exports.generateSwapRouterTxns=Wt,exports.getAccountExcess=function(t){return Ee.apply(this,arguments)},exports.getAccountExcessWithinPool=_e,exports.getAccountInformation=ve,exports.getAddLiquidityTotalFee=function(e){switch(e.version){case C.V1_1:return _n;case C.V2:return n=e.type,(Dn[n]+Sn[n])*t.ALGORAND_MIN_TX_FEE;default:throw new Error("Provided contract version was not valid.")}var n},exports.getAssetInAndAssetOutFromSwapQuote=function(t){return{assetIn:oe(t),assetOut:ie(t)}},exports.getAssetInAndOutFromSwapRoute=Qt,exports.getAssetInFromSwapQuote=oe,exports.getAssetInFromSwapRoute=Ut,exports.getAssetOutFromSwapQuote=ie,exports.getAssetOutFromSwapRoute=Vt,exports.getBestQuote=pe,exports.getMinRequiredBalanceToOptIn=function(t){var e,n=t.currentMinumumBalanceForAccount,r=t.suggestedTransactionFee;if("app-opt-in"===t.type){var a=he(t.contractVersion);e=N+a.schema.numLocalByteSlices*L+a.schema.numLocalInts*F}else e=O;return e+(n||0)+(r||0)},exports.getStakingAppID=function(t){return"testnet"===t?51948952:649588853},exports.getSwapAppCallFeeAmount=re,exports.getSwapQuoteContractVersion=ue,exports.getSwapQuotePriceImpact=function(t){return t.type===Zt.Router?Number(t.data.price_impact):t.data.quote.priceImpact},exports.getSwapQuoteRate=ce,exports.getSwapRoute=Kt,exports.getSwapRouteRate=jt,exports.getSwapRouterAppID=Xt,exports.getSwapRouterAppOptInRequiredAssetIDs=Jt,exports.getSwapTotalFee=function(t){switch(t.version){case C.V1_1:return $t;case C.V2:return te(t.type);default:throw new Error("Provided contract version was not valid.")}},exports.getTxnGroupID=It,exports.getV2MinSwapAssetInAmount=ee,exports.getV2SwapTotalFee=te,exports.getValidatorAppID=wt,exports.hasSufficientMinimumBalance=function(t){return t.amount>=t.minimum_required_balance},exports.isAccountOptedIntoApp=function(t){var e=t.appID;return t.accountAppsLocalState.some((function(t){return t.id===e}))},exports.isSwapAssetInAmountLow=ne,exports.isSwapQuoteErrorCausedByAmount=le,exports.poolUtils=We,exports.prepareCommitTransactions=function(t){return ca.apply(this,arguments)},exports.redeemAllExcessAsset=function(t){return Wr.apply(this,arguments)},exports.redeemExcessAsset=function(t){return Qr.apply(this,arguments)},exports.sendAndWaitRawTransaction=mt,exports.sumUpTxnFees=At,exports.tinymanContract_v1_1=ge,exports.tinymanContract_v2=xe,exports.tinymanJSSDKConfig=Tt;
